<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.spring.web.dao.MonitorMapper" >
  <resultMap id="BaseResultMap" type="com.spring.web.model.Monitor" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <constructor >
      <idArg column="id" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="name" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="memo" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="code" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="user" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="psw" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="user_id" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="del" jdbcType="INTEGER" javaType="java.lang.Integer" />
      
      <arg column="danger_level" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="descr" jdbcType="VARCHAR" javaType="java.lang.String" />  
      <arg column="accident_type" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="duty_people" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="thumbnail" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="puid" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="channel_id" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="img" jdbcType="VARCHAR" javaType="java.lang.String" />
    </constructor>
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, name, memo, code, user, psw, user_id, del,danger_level,descr,duty_people,thumbnail,accident_type,puid,channel_id,img
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from monitor_tbl
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from monitor_tbl
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.spring.web.model.Monitor" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into monitor_tbl (name, memo, code, 
      user, psw, user_id, 
      del,puid,channel_id)
    values (#{name,jdbcType=VARCHAR}, #{memo,jdbcType=VARCHAR}, #{code,jdbcType=VARCHAR}, 
      #{user,jdbcType=VARCHAR}, #{psw,jdbcType=VARCHAR}, #{userId,jdbcType=INTEGER}, 
      #{del,jdbcType=INTEGER},#{puid,jdbcType=VARCHAR},#{channelId,jdbcType=INTEGER},#{img,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.spring.web.model.Monitor" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into monitor_tbl
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="name != null" >
        name,
      </if>
      <if test="memo != null" >
        memo,
      </if>
      <if test="code != null" >
        code,
      </if>
      <if test="user != null" >
        user,
      </if>
      <if test="psw != null" >
        psw,
      </if>
      <if test="userId != null" >
        user_id,
      </if>
      <if test="del != null" >
        del,
      </if>
      <if test="dangerLevel != null" >
        danger_level,
      </if>
      <if test="descr != null" >
        descr,
      </if>
      
      <if test="dutyPeople != null" >
        duty_people,
      </if>
      <if test="accidentType != null" >
        accident_type,
      </if>
      <if test="thumbnail != null" >
        thumbnail,
      </if>
      <if test="puid != null" >
        puid,
      </if>
      <if test="channelId != null" >
        channel_id,
      </if>
      <if test="img != null" >
        img,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="memo != null" >
        #{memo,jdbcType=VARCHAR},
      </if>
      <if test="code != null" >
        #{code,jdbcType=VARCHAR},
      </if>
      <if test="user != null" >
        #{user,jdbcType=VARCHAR},
      </if>
      <if test="psw != null" >
        #{psw,jdbcType=VARCHAR},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="del != null" >
        #{del,jdbcType=INTEGER},
      </if>
      <if test="dangerLevel != null" >
        #{dangerLevel,jdbcType=VARCHAR},
      </if>
      <if test="descr != null" >
        #{descr,jdbcType=VARCHAR},
      </if>
      
      <if test="dutyPeople != null" >
        #{dutyPeople,jdbcType=VARCHAR},
      </if>
      <if test="accidentType != null" >
        #{accidentType,jdbcType=VARCHAR},
      </if>
      <if test="thumbnail != null" >
        #{thumbnail,jdbcType=VARCHAR},
      </if>
      <if test="puid != null" >
        #{puid,jdbcType=VARCHAR},
      </if>
      <if test="channelId != null" >
        #{channelId,jdbcType=INTEGER},
      </if>
      <if test="img != null" >
        #{img,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.spring.web.model.Monitor" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update monitor_tbl
    <set >
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="code != null" >
        code = #{code,jdbcType=VARCHAR},
      </if>
      <if test="user != null" >
        user = #{user,jdbcType=VARCHAR},
      </if>
      <if test="psw != null" >
        psw = #{psw,jdbcType=VARCHAR},
      </if>
      <if test="userId != null" >
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="del != null" >
        del = #{del,jdbcType=INTEGER},
      </if>
      <if test="dangerLevel != null" >
        danger_level = #{dangerLevel,jdbcType=VARCHAR},
      </if>
      <if test="descr != null" >
        descr = #{descr,jdbcType=VARCHAR},
      </if>
      <if test="dutyPeople != null" >
        duty_people = #{dutyPeople,jdbcType=VARCHAR},
      </if>
      <if test="accidentType != null" >
        accident_type = #{accidentType,jdbcType=VARCHAR},
      </if>
      <if test="thumbnail != null" >
        thumbnail = #{thumbnail,jdbcType=VARCHAR},
      </if>
      <if test="puid != null" >
        puid = #{puid,jdbcType=VARCHAR},
      </if>
      <if test="channelId != null" >
        channel_id = #{channelId,jdbcType=INTEGER},
      </if>
      <if test="img != null" >
        img = #{img,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <update id="updateByUserId" parameterType="com.spring.web.model.Monitor" >
    update monitor_tbl
    <set >
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="code != null" >
        code = #{code,jdbcType=VARCHAR},
      </if>
      <if test="user != null" >
        user = #{user,jdbcType=VARCHAR},
      </if>
      <if test="psw != null" >
        psw = #{psw,jdbcType=VARCHAR},
      </if>
      <if test="userId != null" >
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="del != null" >
        del = #{del,jdbcType=INTEGER},
      </if>
      <if test="dangerLevel != null" >
        danger_level = #{dangerLevel,jdbcType=VARCHAR},
      </if>
      <if test="descr != null" >
        descr = #{descr,jdbcType=VARCHAR},
      </if>
      <if test="dutyPeople != null" >
        duty_people = #{dutyPeople,jdbcType=VARCHAR},
      </if>
      <if test="accidentType != null" >
        accident_type = #{accidentType,jdbcType=VARCHAR},
      </if>
      <if test="thumbnail != null" >
        thumbnail = #{thumbnail,jdbcType=VARCHAR},
      </if>
      <if test="puid != null" >
        puid = #{puid,jdbcType=VARCHAR},
      </if>
      <if test="channelId != null" >
        channel_id = #{channelId,jdbcType=INTEGER},
      </if>
      <if test="img != null" >
        img = #{img,jdbcType=VARCHAR},
      </if>
    </set>
    where user_id = #{userId,jdbcType=INTEGER}
  </update>
  
  <update id="updateByUserIdAndName" parameterType="com.spring.web.model.Monitor" >
    update monitor_tbl
    <set >
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="code != null" >
        code = #{code,jdbcType=VARCHAR},
      </if>
      <if test="user != null" >
        user = #{user,jdbcType=VARCHAR},
      </if>
      <if test="psw != null" >
        psw = #{psw,jdbcType=VARCHAR},
      </if>
      <if test="userId != null" >
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="del != null" >
        del = #{del,jdbcType=INTEGER},
      </if>
      <if test="dangerLevel != null" >
        danger_level = #{dangerLevel,jdbcType=VARCHAR},
      </if>
      <if test="descr != null" >
        descr = #{descr,jdbcType=VARCHAR},
      </if>
      <if test="dutyPeople != null" >
        duty_people = #{dutyPeople,jdbcType=VARCHAR},
      </if>
      <if test="accidentType != null" >
        accident_type = #{accidentType,jdbcType=VARCHAR},
      </if>
      <if test="thumbnail != null" >
        thumbnail = #{thumbnail,jdbcType=VARCHAR},
      </if>
      <if test="puid != null" >
        puid = #{puid,jdbcType=VARCHAR},
      </if>
      <if test="channelId != null" >
        channel_id = #{channelId,jdbcType=INTEGER},
      </if>
      <if test="img != null" >
        img = #{img,jdbcType=VARCHAR},
      </if>
    </set>
    where user_id = #{userId,jdbcType=INTEGER}
    	and name = #{name,jdbcType=VARCHAR}
    	and del=0
  </update>
  
  <update id="updateByPrimaryKey" parameterType="com.spring.web.model.Monitor" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update monitor_tbl
    set name = #{name,jdbcType=VARCHAR},
      memo = #{memo,jdbcType=VARCHAR},
      code = #{code,jdbcType=VARCHAR},
      user = #{user,jdbcType=VARCHAR},
      psw = #{psw,jdbcType=VARCHAR},
      user_id = #{userId,jdbcType=INTEGER},
      del = #{del,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <!--  注释掉，zhangcl 2019.1.10不查company_view加快速度 <select id="selectByMap" resultType="java.util.Map">
    select
        T1.id, T1.name, T1.memo, T1.code,T1.danger_level as dangerLevel,T1.descr,T1.duty_people as dutyPeople,T1.accident_type as accidentType,T1.thumbnail as thumbnail, T1.puid,T1.channel_id as channelId,T2.name companyName
    from
      monitor_tbl T1
    left join company_view T2 on T1.user_id = T2.user_id
    <where>
      T1.del = 0
        <if test="userId != null">
            and T1.user_id = #{userId} 
        </if>
        <if test="villageId != null"> and T2.village_id = #{villageId}</if>
        <if test="townId != null"> and T2.town_id = #{townId}</if>
        <if test="districtId != null"> and T2.district_id = #{districtId}</if>
        <if test="tradeId != null">
            and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
        </if>
        <if test="companyName != null and companyName != ''">
         and T2.name LIKE CONCAT('%', #{companyName},'%')
        </if>
        <if test="name != null"> and T1.name = #{name}</if>
    </where>
  </select>-->
  <select id="selectByMap" resultType="java.util.Map">
    select
        T1.id, T1.user_id as userId,T1.name, T1.memo, T1.code,T1.danger_level as dangerLevel,T1.descr,T1.duty_people as dutyPeople,T1.accident_type as accidentType,T1.thumbnail as thumbnail, T1.puid,T1.channel_id as channelId, T1.img
    from
      monitor_tbl T1
    <where>
      T1.del = 0
        <if test="userId != null"> and T1.user_id = #{userId}</if>
        <if test="villageId != null"> and T2.village_id = #{villageId}</if>
        <if test="townId != null"> and T2.town_id = #{townId}</if>
        <if test="districtId != null"> and T2.district_id = #{districtId}</if>
        <if test="tradeId != null"> and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )</if>
        <if test="name != null"> and T1.name = #{name}</if>
    </where>
  </select>
  
  <!--
  <select id="selectWithDelByMap" resultType="java.util.Map">
    select
        T1.id, T1.name, T1.memo, T1.code,T1.danger_level as dangerLevel,T1.descr,T1.duty_people as dutyPeople,T1.accident_type as accidentType,T1.thumbnail as thumbnail, T1.puid,T1.channel_id as channelId
    from
      monitor_tbl T1
    <where>
        <if test="del != null"> and T1.del = #{del}</if>
        <if test="userId != null"> and T1.user_id = #{userId}</if>
        <if test="villageId != null"> and T2.village_id = #{villageId}</if>
        <if test="townId != null"> and T2.town_id = #{townId}</if>
        <if test="districtId != null"> and T2.district_id = #{districtId}</if>
        <if test="tradeId != null"> and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )</if>
        <if test="name != null"> and T1.name = #{name}</if>
    </where>
  </select>
  -->
  
  <select id="selectMonitorByMap" resultType="java.util.Map">
    select
        T1.id, T1.name, T1.memo, T1.code,T1.danger_level as dangerLevel,T1.descr, T1.duty_people as dutyPeople,T1.accident_type as accidentType, T1.thumbnail as thumbnail,T1.puid,T1.channel_id as channelId,T1.img,T2.name companyName
    from
      monitor_tbl T1
    left join company_view T2 on T1.user_id = T2.user_id
    <where>
      T1.del = 0
        <if test="userId != null">
            and T1.user_id = #{userId} 
        </if>
        <if test="userIds != null">
        and T1.user_id in 
        <foreach close=")" collection="userIds" item="item" open="(" separator=",">
        	#{item}
        </foreach>
    	</if>
        <if test="villageId != null"> and T2.village_id = #{villageId}</if>
        <if test="townId != null"> and T2.town_id = #{townId}</if>
        <if test="districtId != null"> and T2.district_id = #{districtId}</if>
        <if test="tradeId != null">
            and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
        </if>
        <if test="companyName != null and companyName != ''">
         and T2.name LIKE CONCAT('%', #{companyName},'%')
        </if>
    </where>
    limit #{page},#{limit}
  </select>
  
  <select id="selectGroupByMap" resultType="java.util.Map">
    SELECT
        T1.user_id userId,
        T2.NAME companyName,
        count( * ) AS count 
    FROM
        monitor_tbl T1
        LEFT JOIN company_view T2 ON T1.user_id = T2.user_id 
    <where>
      T1.del = 0
        <if test="userId != null">and T1.user_id = #{userId} </if>
        <if test="userIds != null">and T1.user_id in (${userIds} )</if>
        <if test="villageId != null"> and T2.village_id = #{villageId}</if>
        <if test="townId != null"> and T2.town_id = #{townId}</if>
        <if test="districtId != null"> and T2.district_id = #{districtId}</if>
        <if test="tradeId != null">
            and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
        </if>
        <if test="companyName != null and companyName != ''">
         and T2.name LIKE CONCAT('%', #{companyName},'%')
        </if>
    </where>
    GROUP BY
        T2.user_id
  </select>
  
  <select id="selectCount" resultType="java.lang.Integer">
    SELECT
        count(0)
    FROM
        monitor_tbl T1
    <where>
        T1.del = 0
        <if test="userIds != null and userIds != ''">
        and user_id in (${userIds})
        </if>
    </where>
  </select>
</mapper>