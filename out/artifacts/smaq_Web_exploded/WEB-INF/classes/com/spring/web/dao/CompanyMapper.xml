<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.web.dao.CompanyMapper">
	<resultMap id="BaseResultMap" type="com.spring.web.model.Company">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<constructor>
			<idArg column="user_id" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="village_id" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="name" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="reg_type" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="reg_type2" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="region_id" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="address" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="legal" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="legal_contact" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="capital" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="establish" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="business" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="scope" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="license" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="reg_region" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="authority" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="economic" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="fixed" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="staff" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="income" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="industry" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="danger" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="dangers" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="hazard" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="dlevel" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="charge" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="charge_contact" javaType="java.lang.String"
				jdbcType="VARCHAR" />
			<arg column="safety" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="safety_contact" javaType="java.lang.String"
				jdbcType="VARCHAR" />
			<arg column="safety_m" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="safety_m_contact" javaType="java.lang.String"
				jdbcType="VARCHAR" />
			<arg column="duty" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="postage" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="email" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="pic1" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="pic2" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="is_key" javaType="java.lang.Integer" jdbcType="INTEGER" />
			<arg column="industry2" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="scale" javaType="java.lang.String" jdbcType="VARCHAR" />
			<arg column="area_range" javaType="java.lang.String" jdbcType="VARCHAR" />
		</constructor>
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		user_id, village_id, name, reg_type, reg_type2, region_id, address,
		legal, legal_contact,
		capital, establish, business, scope, license, reg_region, authority, economic,
		fixed,
		staff, income, industry, danger, dangers, hazard, dlevel, charge,
		charge_contact,
		safety, safety_contact, safety_m, safety_m_contact, duty, postage, email,
		pic1, pic2,
		is_key, industry2, scale, area_range
	</sql>
	<select id="selectByPrimaryKey"   parameterType="java.lang.Integer"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		from company_tbl
		where user_id = #{userId, jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from company_tbl
		where user_id = #{userId,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.spring.web.model.Company">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into company_tbl (user_id, village_id, name,
		reg_type, reg_type2, region_id,
		address, legal, legal_contact,
		capital, establish, business,
		scope, license, reg_region,
		authority, economic, fixed,
		staff, income, industry,
		danger, dangers, hazard,
		dlevel, charge, charge_contact,
		safety, safety_contact, safety_m,
		safety_m_contact, duty, postage,
		email, pic1, pic2,
		is_key, industry2, scale,
		area_range)
		values (#{userId,jdbcType=INTEGER}, #{villageId,jdbcType=INTEGER},
		#{name,jdbcType=VARCHAR},
		#{regType,jdbcType=VARCHAR}, #{regType2,jdbcType=VARCHAR}, #{regionId,jdbcType=INTEGER},
		#{address,jdbcType=VARCHAR}, #{legal,jdbcType=VARCHAR},
		#{legalContact,jdbcType=VARCHAR},
		#{capital,jdbcType=VARCHAR}, #{establish,jdbcType=VARCHAR}, #{business,jdbcType=VARCHAR},
		#{scope,jdbcType=VARCHAR}, #{license,jdbcType=VARCHAR},
		#{regRegion,jdbcType=INTEGER},
		#{authority,jdbcType=VARCHAR}, #{economic,jdbcType=VARCHAR}, #{fixed,jdbcType=VARCHAR},
		#{staff,jdbcType=INTEGER}, #{income,jdbcType=VARCHAR},
		#{industry,jdbcType=VARCHAR},
		#{danger,jdbcType=INTEGER}, #{dangers,jdbcType=VARCHAR}, #{hazard,jdbcType=INTEGER},
		#{dlevel,jdbcType=VARCHAR}, #{charge,jdbcType=VARCHAR},
		#{chargeContact,jdbcType=VARCHAR},
		#{safety,jdbcType=VARCHAR}, #{safetyContact,jdbcType=VARCHAR}, #{safetyM,jdbcType=VARCHAR},
		#{safetyMContact,jdbcType=VARCHAR}, #{duty,jdbcType=VARCHAR},
		#{postage,jdbcType=VARCHAR},
		#{email,jdbcType=VARCHAR}, #{pic1,jdbcType=VARCHAR}, #{pic2,jdbcType=VARCHAR},
		#{isKey,jdbcType=INTEGER}, #{industry2,jdbcType=VARCHAR},
		#{scale,jdbcType=VARCHAR},
		#{areaRange,jdbcType=VARCHAR})
	</insert>
	<insert id="insertSelective" parameterType="com.spring.web.model.Company">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into company_tbl
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="userId != null">
				user_id,
			</if>
			<if test="villageId != null">
				village_id,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="regType != null">
				reg_type,
			</if>
			<if test="regType2 != null">
				reg_type2,
			</if>
			<if test="regionId != null">
				region_id,
			</if>
			<if test="address != null">
				address,
			</if>
			<if test="legal != null">
				legal,
			</if>
			<if test="legalContact != null">
				legal_contact,
			</if>
			<if test="capital != null">
				capital,
			</if>
			<if test="establish != null">
				establish,
			</if>
			<if test="business != null">
				business,
			</if>
			<if test="scope != null">
				scope,
			</if>
			<if test="license != null">
				license,
			</if>
			<if test="regRegion != null">
				reg_region,
			</if>
			<if test="authority != null">
				authority,
			</if>
			<if test="economic != null">
				economic,
			</if>
			<if test="fixed != null">
				fixed,
			</if>
			<if test="staff != null">
				staff,
			</if>
			<if test="income != null">
				income,
			</if>
			<if test="industry != null">
				industry,
			</if>
			<if test="danger != null">
				danger,
			</if>
			<if test="dangers != null">
				dangers,
			</if>
			<if test="hazard != null">
				hazard,
			</if>
			<if test="dlevel != null">
				dlevel,
			</if>
			<if test="charge != null">
				charge,
			</if>
			<if test="chargeContact != null">
				charge_contact,
			</if>
			<if test="safety != null">
				safety,
			</if>
			<if test="safetyContact != null">
				safety_contact,
			</if>
			<if test="safetyM != null">
				safety_m,
			</if>
			<if test="safetyMContact != null">
				safety_m_contact,
			</if>
			<if test="duty != null">
				duty,
			</if>
			<if test="postage != null">
				postage,
			</if>
			<if test="email != null">
				email,
			</if>
			<if test="pic1 != null">
				pic1,
			</if>
			<if test="pic2 != null">
				pic2,
			</if>
			<if test="isKey != null">
				is_key,
			</if>
			<if test="industry2 != null">
				industry2,
			</if>
			<if test="scale != null">
				scale,
			</if>
			<if test="areaRange != null">
				area_range,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="userId != null">
				#{userId,jdbcType=INTEGER},
			</if>
			<if test="villageId != null">
				#{villageId,jdbcType=INTEGER},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="regType != null">
				#{regType,jdbcType=VARCHAR},
			</if>
			<if test="regType2 != null">
				#{regType2,jdbcType=VARCHAR},
			</if>
			<if test="regionId != null">
				#{regionId,jdbcType=INTEGER},
			</if>
			<if test="address != null">
				#{address,jdbcType=VARCHAR},
			</if>
			<if test="legal != null">
				#{legal,jdbcType=VARCHAR},
			</if>
			<if test="legalContact != null">
				#{legalContact,jdbcType=VARCHAR},
			</if>
			<if test="capital != null">
				#{capital,jdbcType=VARCHAR},
			</if>
			<if test="establish != null">
				#{establish,jdbcType=VARCHAR},
			</if>
			<if test="business != null">
				#{business,jdbcType=VARCHAR},
			</if>
			<if test="scope != null">
				#{scope,jdbcType=VARCHAR},
			</if>
			<if test="license != null">
				#{license,jdbcType=VARCHAR},
			</if>
			<if test="regRegion != null">
				#{regRegion,jdbcType=INTEGER},
			</if>
			<if test="authority != null">
				#{authority,jdbcType=VARCHAR},
			</if>
			<if test="economic != null">
				#{economic,jdbcType=VARCHAR},
			</if>
			<if test="fixed != null">
				#{fixed,jdbcType=VARCHAR},
			</if>
			<if test="staff != null">
				#{staff,jdbcType=INTEGER},
			</if>
			<if test="income != null">
				#{income,jdbcType=VARCHAR},
			</if>
			<if test="industry != null">
				#{industry,jdbcType=VARCHAR},
			</if>
			<if test="danger != null">
				#{danger,jdbcType=INTEGER},
			</if>
			<if test="dangers != null">
				#{dangers,jdbcType=VARCHAR},
			</if>
			<if test="hazard != null">
				#{hazard,jdbcType=INTEGER},
			</if>
			<if test="dlevel != null">
				#{dlevel,jdbcType=VARCHAR},
			</if>
			<if test="charge != null">
				#{charge,jdbcType=VARCHAR},
			</if>
			<if test="chargeContact != null">
				#{chargeContact,jdbcType=VARCHAR},
			</if>
			<if test="safety != null">
				#{safety,jdbcType=VARCHAR},
			</if>
			<if test="safetyContact != null">
				#{safetyContact,jdbcType=VARCHAR},
			</if>
			<if test="safetyM != null">
				#{safetyM,jdbcType=VARCHAR},
			</if>
			<if test="safetyMContact != null">
				#{safetyMContact,jdbcType=VARCHAR},
			</if>
			<if test="duty != null">
				#{duty,jdbcType=VARCHAR},
			</if>
			<if test="postage != null">
				#{postage,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				#{email,jdbcType=VARCHAR},
			</if>
			<if test="pic1 != null">
				#{pic1,jdbcType=VARCHAR},
			</if>
			<if test="pic2 != null">
				#{pic2,jdbcType=VARCHAR},
			</if>
			<if test="isKey != null">
				#{isKey,jdbcType=INTEGER},
			</if>
			<if test="industry2 != null">
				#{industry2,jdbcType=VARCHAR},
			</if>
			<if test="scale != null">
				#{scale,jdbcType=VARCHAR},
			</if>
			<if test="areaRange != null">
				#{areaRange,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.spring.web.model.Company">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update company_tbl
		<set>
			<if test="villageId != null">
				village_id = #{villageId,jdbcType=INTEGER},
			</if>
			<if test="name != null">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="regType != null">
				reg_type = #{regType,jdbcType=VARCHAR},
			</if>
			<if test="regType2 != null">
				reg_type2 = #{regType2,jdbcType=VARCHAR},
			</if>
			<if test="regionId != null">
				region_id = #{regionId,jdbcType=INTEGER},
			</if>
			<if test="address != null">
				address = #{address,jdbcType=VARCHAR},
			</if>
			<if test="legal != null">
				legal = #{legal,jdbcType=VARCHAR},
			</if>
			<if test="legalContact != null">
				legal_contact = #{legalContact,jdbcType=VARCHAR},
			</if>
			<if test="capital != null">
				capital = #{capital,jdbcType=VARCHAR},
			</if>
			<if test="establish != null">
				establish = #{establish,jdbcType=VARCHAR},
			</if>
			<if test="business != null">
				business = #{business,jdbcType=VARCHAR},
			</if>
			<if test="scope != null">
				scope = #{scope,jdbcType=VARCHAR},
			</if>
			<if test="license != null">
				license = #{license,jdbcType=VARCHAR},
			</if>
			<if test="regRegion != null">
				reg_region = #{regRegion,jdbcType=INTEGER},
			</if>
			<if test="authority != null">
				authority = #{authority,jdbcType=VARCHAR},
			</if>
			<if test="economic != null">
				economic = #{economic,jdbcType=VARCHAR},
			</if>
			<if test="fixed != null">
				fixed = #{fixed,jdbcType=VARCHAR},
			</if>
			<if test="staff != null">
				staff = #{staff,jdbcType=INTEGER},
			</if>
			<if test="income != null">
				income = #{income,jdbcType=VARCHAR},
			</if>
			<if test="industry != null">
				industry = #{industry,jdbcType=VARCHAR},
			</if>
			<if test="danger != null">
				danger = #{danger,jdbcType=INTEGER},
			</if>
			<if test="dangers != null">
				dangers = #{dangers,jdbcType=VARCHAR},
			</if>
			<if test="hazard != null">
				hazard = #{hazard,jdbcType=INTEGER},
			</if>
			<if test="dlevel != null">
				dlevel = #{dlevel,jdbcType=VARCHAR},
			</if>
			<if test="charge != null">
				charge = #{charge,jdbcType=VARCHAR},
			</if>
			<if test="chargeContact != null">
				charge_contact = #{chargeContact,jdbcType=VARCHAR},
			</if>
			<if test="safety != null">
				safety = #{safety,jdbcType=VARCHAR},
			</if>
			<if test="safetyContact != null">
				safety_contact = #{safetyContact,jdbcType=VARCHAR},
			</if>
			<if test="safetyM != null">
				safety_m = #{safetyM,jdbcType=VARCHAR},
			</if>
			<if test="safetyMContact != null">
				safety_m_contact = #{safetyMContact,jdbcType=VARCHAR},
			</if>
			<if test="duty != null">
				duty = #{duty,jdbcType=VARCHAR},
			</if>
			<if test="postage != null">
				postage = #{postage,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				email = #{email,jdbcType=VARCHAR},
			</if>
			<if test="pic1 != null">
				pic1 = #{pic1,jdbcType=VARCHAR},
			</if>
			<if test="pic2 != null">
				pic2 = #{pic2,jdbcType=VARCHAR},
			</if>
			<if test="isKey != null">
				is_key = #{isKey,jdbcType=INTEGER},
			</if>
			<if test="industry2 != null">
				industry2 = #{industry2,jdbcType=VARCHAR},
			</if>
			<if test="scale != null">
				scale = #{scale,jdbcType=VARCHAR},
			</if>
			<if test="areaRange != null">
				area_range = #{areaRange,jdbcType=VARCHAR},
			</if>
		</set>
		where user_id = #{userId,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.spring.web.model.Company">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update company_tbl
		set village_id = #{villageId,jdbcType=INTEGER},
		name = #{name,jdbcType=VARCHAR},
		reg_type = #{regType,jdbcType=VARCHAR},
		reg_type2 = #{regType2,jdbcType=VARCHAR},
		region_id = #{regionId,jdbcType=INTEGER},
		address = #{address,jdbcType=VARCHAR},
		legal = #{legal,jdbcType=VARCHAR},
		legal_contact = #{legalContact,jdbcType=VARCHAR},
		capital = #{capital,jdbcType=VARCHAR},
		establish = #{establish,jdbcType=VARCHAR},
		business = #{business,jdbcType=VARCHAR},
		scope = #{scope,jdbcType=VARCHAR},
		license = #{license,jdbcType=VARCHAR},
		reg_region = #{regRegion,jdbcType=INTEGER},
		authority = #{authority,jdbcType=VARCHAR},
		economic = #{economic,jdbcType=VARCHAR},
		fixed = #{fixed,jdbcType=VARCHAR},
		staff = #{staff,jdbcType=INTEGER},
		income = #{income,jdbcType=VARCHAR},
		industry = #{industry,jdbcType=VARCHAR},
		danger = #{danger,jdbcType=INTEGER},
		dangers = #{dangers,jdbcType=VARCHAR},
		hazard = #{hazard,jdbcType=INTEGER},
		dlevel = #{dlevel,jdbcType=VARCHAR},
		charge = #{charge,jdbcType=VARCHAR},
		charge_contact = #{chargeContact,jdbcType=VARCHAR},
		safety = #{safety,jdbcType=VARCHAR},
		safety_contact = #{safetyContact,jdbcType=VARCHAR},
		safety_m = #{safetyM,jdbcType=VARCHAR},
		safety_m_contact = #{safetyMContact,jdbcType=VARCHAR},
		duty = #{duty,jdbcType=VARCHAR},
		postage = #{postage,jdbcType=VARCHAR},
		email = #{email,jdbcType=VARCHAR},
		pic1 = #{pic1,jdbcType=VARCHAR},
		pic2 = #{pic2,jdbcType=VARCHAR},
		is_key = #{isKey,jdbcType=INTEGER},
		industry2 = #{industry2,jdbcType=VARCHAR},
		scale = #{scale,jdbcType=VARCHAR},
		area_range = #{areaRange,jdbcType=VARCHAR}
		where user_id = #{userId,jdbcType=INTEGER}
	</update>

	<select id="selectCompanyList" parameterType="java.lang.String"
		resultType="com.spring.web.ibatis.DynamicParameter">
		select
		T1.user_id userId, T1.name, T1.industry, T1.industry2, T1.scale,
		T1.dlevel, T1.address, T1.is_key isKey, T1.dangers, T1.charge,
		<if test="tradeId != null">
			(SELECT iskey FROM trade_company_tbl WHERE tid = ${tradeId} and uid =
			T1.user_id limit 1) tradeKey,
			(SELECT id FROM trade_company_tbl WHERE tid = ${tradeId} and uid =
			T1.user_id limit 1) tradeCompanyId,
		</if>
		T1.district_id districtId, T1.town_id townId, T1.village_id villageId,
		(select region_name from global_region_view where id = T1.region_id)
		regionName,
		T2.is_freeze isFreeze, T1.village_name villageName, T1.town_name townName,
		T3.key1, T3.key2, T3.key3, T3.key4 , T2.user_name userName,
		T4.danger_material dangerMaterial,T4.danger_lvl dangerlvl,
		T5.material, T5.maximum_storage maximumStorage, T5.state,
		T5.storage_location storageLocation, T5.storage_method storageMethod
		from
		(select * from company_view
		<where>
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		)
		T1
		left join user_tbl T2 on T1.user_id = T2.id
		left join regulation_tbl T4 on T1.user_id = T4.user_id
		left join company_iskey_tbl T3 on T1.user_id = T3.user_id
		LEFT JOIN material_tbl T5 ON T1.user_id = T5.user_id
		<where>
			T1.is_del = '0'
			<if test="companyName != null and companyName != ''">
				and T1.name LIKE CONCAT('%', #{companyName},'%')
			</if>
			<if test="villageName != null and villageName != ''">
				and T1.village_name LIKE CONCAT('%', #{villageName},'%')
			</if>
			<if test="coType != null and coType != ''">
				and T1.industry = #{coType}
			</if>
			<if test="villageId != null">
				and T1.village_id = #{villageId}
			</if>
			<if test="districtId != null">
				and T1.district_id = #{districtId}
			</if>
			<if test="townId != null">
				and T1.town_id = #{townId}
			</if>
			<if test="tradeId != null">
				and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
				#{tradeId} )
			</if>
			<if test="isFreeze != null and isFreeze != ''">
				and T2.is_freeze = #{isFreeze}
			</if>
			<if test="dlevel != null and dlevel != ''">
				and T1.dlevel in (${dlevel})
			</if>
			<if test="key1 != null">
				and T3.key1 = #{key1}
			</if>
			<if test="key2 != null">
				and T3.key2 = #{key2}
			</if>
			<if test="key3 != null">
				and T3.key3 = #{key3}
			</if>
			<if test="key4 != null">
				and T3.key4 = #{key4}
			</if>
			<if test="danger != null">
				and T1.danger = #{danger}
			</if>
			<if test="hazard != null">
				and T1.hazard = #{hazard}
			</if>
			<if test="isKey != null and isKey !='' or isKey==0">
				and T1.is_key = #{isKey}
			</if>
			<if test="cisDanger != null and cisDanger != ''">
				and T4.cis_danger = #{cisDanger}
			</if>
			<if test="chemic != null and chemic != ''">
				and T4.chemic = #{chemic}
			</if>
			<if test="doubleDanger != null and doubleDanger != ''">
				<!-- and T1.dlevel in ("红色","橙色") -->
				and (T1.industry = '化工企业（危险化学品生产、经营、使用）、加油站' or T1.danger = 1)
			</if>
			<if test="industry2 != null and industry2 != ''">
				and T1.industry2 like CONCAT(#{industry2}, '%')
			</if>
			<if test="industry != null and industry != ''">
				and T1.industry = #{industry}
			</if>
			<if test="scale != null and scale != ''">
				and T1.scale = #{scale}
			</if>
		</where>
		group by T1.user_id
		<if test="isTradeKey != null and isTradeKey != ''">
			HAVING tradeKey = #{isTradeKey}
		</if>
		<choose>
			<when test="districtId != null"> order by key2 desc, userId desc</when>
			<when test="townId != null"> order by key1 desc, userId desc</when>
			<when test="villageId != null"> order by isKey desc, userId desc</when>
			<when test="user_id != null"> order by T1.user_id desc</when>
		</choose>
		<if test="rows != null">
			limit #{index}, #{rows}
		</if>
	</select>

	<select id="selectCount" parameterType="java.lang.Integer"
		resultType="java.lang.Integer">
		select count(0)
		from (select * from company_view
		<where>
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		) T1
		where T1.is_del = '0'
		<if test="villageId != null"> and T1.village_id = #{villageId}</if>
		<if test="townId != null"> and T1.town_id = #{townId}</if>
		<if test="districtId != null"> and T1.district_id = #{districtId}</if>
		<if test="tradeId != null">
			and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
			#{tradeId} )
		</if>
	</select>

	<select id="selectCountMap" resultType="java.lang.Integer">
		select count(0)
		from (select * from company_view
		<where>
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		) T1
		where T1.is_del = '0'
		<if test="companyName != null and companyName != ''">
			and T1.name LIKE CONCAT('%', #{companyName},'%')
		</if>
		<if test="dlevel != null and dlevel != ''">
			and T1.dlevel LIKE CONCAT('%', #{dlevel},'%')
		</if>
		<if test="villageId != null"> and T1.village_id = #{villageId}</if>
		<if test="townId != null"> and T1.town_id = #{townId}</if>
		<if test="districtId != null"> and T1.district_id = #{districtId}</if>
		<if test="tradeId != null">
			and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
			#{tradeId} )
		</if>
		<if test="industry != null and industry != ''">
			and T1.industry2 like CONCAT(#{industry}, '%')
		</if>
	</select>

	<select id="selectYuCount" resultType="java.lang.Integer">
    <![CDATA[
    select count(0) from sperson_tbl where review_time <= #{time} and review_time >= #{now} and user_id = #{userId}
    union all
    select count(0) from sequipment_tbl where expiration_time <= #{time} and expiration_time >= #{now} and user_id = #{userId}
    union all
    select count(0) from detection_tbl where expiration_time <= #{time} and expiration_time >= #{now} and user_id = #{userId}
    union all
    select count(0) from examination_tbl where end_time <= #{time} and end_time >= #{now} and user_id = #{userId}
    
    union all
    select count(0) from evaluation_tbl where expiration_time <= #{time3} and expiration_time >= #{now1} and user_id = #{userId}

    union all
    select count(0) from standard_tbl where time_exp <= #{time2} and time_exp >= #{now} and user_id = #{userId}
    
    union all
    select count(0) from t_check_tbl where del = 0 and user_id = #{userId} and status = 1 and flag = 1
    
    union all
    select count(0) from t_check_item_view2 where d = 1 and user_id = #{userId} and status = 2
    
    union all
    select count(0) from t_contingency_plan_tbl where active_time <= #{time3} and active_time >= #{now1} and user_id = #{userId}
    ]]>
	</select>

	<select id="selectYuCountAll_Old" resultType="java.lang.Integer">
     
    <![CDATA[
    select count(0) from sperson_tbl where review_time <= #{time} and review_time >= #{now} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		union all
    <![CDATA[select count(0) from sequipment_tbl where expiration_time <= #{time} and expiration_time >= #{now} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		union all
    <![CDATA[select count(0) from detection_tbl where expiration_time <= #{time} and expiration_time >= #{now} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		union all
    <![CDATA[select count(0) from examination_tbl where end_time <= #{time} and end_time >= #{now} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[select count(0) from evaluation_tbl where expiration_time <= #{time3} and expiration_time >= #{now1} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[select count(0) from standard_tbl where time_exp <= #{time2} and time_exp >= #{now} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[select count(0) from recheck_yj_view where c = 0 ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[select count(0) from t_check_item_view2 where d = 1 and status = 2 ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[select count(0) from t_contingency_plan_tbl where active_time <= #{time3} and active_time >= #{now1} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[
    	select count(0) 
    	from t_check_tbl T1 
    	where expect_time is not null and expect_time < #{now1} and status =1 and del = 0 and flag=1	
    ]]>
		<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

	</select>
	
	<!-- update测试  190131 wz old在上面做参考比较  -->
	<select id="selectYuCountAll" resultType="java.lang.Integer">
     
    <![CDATA[
    select count(0) from sperson_tbl where review_time <= #{time} and review_time >= #{now} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		union all
    <![CDATA[select count(0) from sequipment_tbl where expiration_time <= #{time} and expiration_time >= #{now} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		union all
    <![CDATA[select count(0) from detection_tbl where expiration_time <= #{time} and expiration_time >= #{now} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		union all
    <![CDATA[select count(0) from examination_tbl where end_time <= #{time} and end_time >= #{now} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[select count(0) from evaluation_tbl where expiration_time <= #{time3} and expiration_time >= #{now1} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[select count(0) from standard_tbl where time_exp <= #{time2} and time_exp >= #{now} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[select count(0) from recheck_yj_view where c = 0 ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[select count(0) from t_check_item_view2 where d = 1 and status = 2 ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[select count(0) from t_contingency_plan_tbl where active_time <= #{time3} and active_time >= #{now1} ]]><if
		test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

		union all
    <![CDATA[
    	select count(0) 
    	from t_check_tbl T1 
    	where expect_time is not null and expect_time < #{now1} and status =1 and del = 0 and flag=1	
    ]]>
		<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>

	</select>

	<select id="selectIndustry" resultType="com.spring.web.ibatis.DynamicParameter">
		select
		count(0) c, industry
		from company_tbl
		<where>
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		group by industry
	</select>

	<select id="selectIndustryByScale" resultType="com.spring.web.ibatis.DynamicParameter">
		select
		count(0) c, industry
		from company_tbl
		<where>
			scale = '规上'
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		group by industry
	</select>

	<select id="selectIndustry2" resultType="com.spring.web.ibatis.DynamicParameter">
		select
		count(0) c, industry2
		from company_tbl
		<where>
			industry2 is not null and industry2 != ''
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		group by industry2
	</select>

	<select id="selectIndustry2AndScore" resultType="com.spring.web.ibatis.DynamicParameter">
		select
		count(0) c, industry2
		from company_tbl
		<where>
			scale = '规上' and industry2 is not null and industry2 != ''
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		group by industry2
	</select>

	<select id="selectDlevel" resultType="com.spring.web.ibatis.DynamicParameter">
		select count(0) as amount, dlevel
		from company_tbl
		<where>
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		group by dlevel
	</select>

	<select id="selectCompanyMap" resultType="com.spring.web.ibatis.DynamicParameter">
		SELECT
		T1.user_id userId,T1.village_id villageId,T1.town_id townId,
		T1.safety_contact safetyContact,
		T1.name companyName,T1.dlevel level,GPS_DOUBLE_CHANGE(T2.longitude)
		longitude,
		GPS_DOUBLE_CHANGE(T2.latitude) latitude, T1.legal_contact legalContact, T1.address address,
		T1.reg_type regType
		FROM
		(select * from company_view
		<where>
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		) T1
		LEFT JOIN user_tbl T2 ON T1.user_id = T2.id
		LEFT JOIN regulation_tbl T3 ON T1.user_id = T3.user_id
		WHERE
		T1.is_del = 0
		<if test="companyName != null and companyName != ''">
			and T1.name LIKE CONCAT('%', #{companyName},'%')
		</if>
		<if test="dlevel != null and dlevel != ''">
			and T1.dlevel LIKE CONCAT('%', #{dlevel},'%')
		</if>
		<if test="villageId != null"> and T1.village_id = #{villageId}</if>
		<if test="townId != null"> and T1.town_id = #{townId}</if>
		<if test="districtId != null"> and T1.district_id = #{districtId}</if>
		<if test="tradeId != null">
			and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
			#{tradeId} )
		</if>
		<if test="industry != null and industry != ''">
			and T1.industry2 like CONCAT(#{industry}, '%')
		</if>
		<if test="cisDanger != null"> and T3.cis_danger = #{cisDanger}</if>
		<if test="chemic != null"> and T3.chemic = #{chemic}</if>
		<if test="page != null and page != '' or page == 0">
			LIMIT 0, 1000
		</if>
	</select>
	
	<select id="selectCompanyMapTC" resultType="com.spring.web.ibatis.DynamicParameter">
		SELECT
		T1.user_id userId,T1.village_id villageId,T1.village_id townId,
		T1.safety_contact safetyContact,
		T1.name companyName,T1.dlevel level,GPS_DOUBLE_CHANGE(T2.longitude)
		longitude,
		GPS_DOUBLE_CHANGE(T2.latitude) latitude, T1.legal_contact legalContact, T1.address address,
		T1.reg_type regType
		FROM user_tbl T2 
		LEFT JOIN trade_clique_tbl T1 ON T1.user_id = T2.id
		LEFT JOIN regulation_tbl T3 ON T1.user_id = T3.user_id
		WHERE
			 T2.id = #{userId} and T2.is_del = 0
		<if test="companyName != null and companyName != ''">
			and T1.name LIKE CONCAT('%', #{companyName},'%')
		</if>
		<if test="dlevel != null and dlevel != ''">
			and T1.dlevel LIKE CONCAT('%', #{dlevel},'%')
		</if>
		<if test="industry != null and industry != ''">
			and T1.industry2 like CONCAT(#{industry}, '%')
		</if>
		<if test="cisDanger != null"> and T3.cis_danger = #{cisDanger}</if>
		<if test="chemic != null"> and T3.chemic = #{chemic}</if>
		<if test="page != null and page != '' or page == 0">
			LIMIT 0, 1000
		</if>
	</select>
	

	<select id="selectCompanyMapByTown" resultType="com.spring.web.ibatis.DynamicParameter">
		SELECT
		T1.user_id userId,T1.village_id villageId,T1.name
		companyName,T1.dlevel,T2.longitude,T2.latitude
		FROM
		(select * from company_view
		<where>
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		) T1
		LEFT JOIN user_tbl T2 ON T1.user_id = T2.id
		WHERE
		T1.is_del = 0
		AND T1.town_id = #{townId}
	</select>

	<insert id="insertBatch" parameterType="com.spring.web.model.Company">
		INSERT INTO
		company_tbl(user_id, village_id, name,
		reg_type, reg_type2, region_id,
		address, legal, legal_contact,
		capital, establish, business,
		scope, license, reg_region,
		authority, economic, fixed,
		staff, income, industry,
		danger, dangers, hazard,
		dlevel, charge, charge_contact,
		safety, safety_contact, safety_m,
		safety_m_contact, duty, postage,
		email, pic1, pic2,
		is_key, industry2)
		VALUES
		<foreach collection="list" item="item" separator=",">
			(#{item.userId},#{item.villageId},#{item.name},#{item.regType},#{item.regType2},#{item.regionId},
			#{item.address},#{item.legal},#{item.legalContact},#{item.capital},
			#{item.establish},#{item.business},#{item.scope},#{item.license},
			#{item.regRegion},#{item.authority},#{item.economic},#{item.fixed},
			#{item.staff},#{item.income},#{item.industry},
			#{item.danger},#{item.dangers},#{item.hazard},#{item.dlevel},#{item.charge},#{item.chargeContact},
			#{item.safety},#{item.safetyContact},#{item.safetyM},
			#{item.safetyMContact},#{item.duty},#{item.postage},#{item.email},#{item.pic1},#{item.pic2},0,
			#{item.industry2})
		</foreach>
	</insert>

	<select id="selectNeedCompanyList" parameterType="java.lang.String"
		resultType="com.spring.web.ibatis.DynamicParameter">
		select
		<if test="showProblemCompany != null">
			T6.problemCount problemCount,
		</if>
		T1.user_id userId, T1.name, T1.industry, T1.dlevel, T1.address,
		T1.is_key isKey, T1.dangers, T1.charge,
		<if test="tradeId != null">
			( SELECT iskey FROM trade_company_tbl WHERE tid = ${tradeId} and uid =
			T1.user_id limit 1) tradeKey,
			( SELECT id FROM trade_company_tbl WHERE tid = ${tradeId} and uid =
			T1.user_id limit 1) tradeCompanyId,
		</if>
		T1.district_id districtId, T1.town_id townId, T1.village_id villageId,
		(select region_name from global_region_view where id = T1.region_id)
		regionName,
		T2.is_freeze isFreeze, T1.village_name villageName, T1.town_name townName,
		T3.key1, T3.key2, T3.key3, T3.key4 , T2.user_name userName,
		T5.material, T5.maximum_storage maximumStorage, T5.state,
		T5.storage_location storageLocation, T5.storage_method storageMethod
		from company_view T1
		left join user_tbl T2 on T1.user_id = T2.id
		left join regulation_tbl T4 on T1.user_id = T4.user_id
		left join company_iskey_tbl T3 on T1.user_id = T3.user_id
		LEFT JOIN material_tbl T5 ON T1.user_id = T5.user_id

		<if test="showProblemCompany != null">
			INNER JOIN
			(SELECT
			COUNT(t41.user_id ) AS problemCount,t41.`user_id` AS user_id,t41.name companyName,
			t21.real_time realTime,
			t11.id , t11.content, t11.reference, t11.status, t11.memo, t11.files,
			t11.levels,
			tcp.name partName,
			t21.depart, tcp.part_img partImg, t21.check_company checkCompany,
			t21.flag, t21.cheker,t21.industry_type industryType,
			IF(FIND_IN_SET(t11.id, t31.item3), 1, 0) AS d
			FROM
			t_check_item_tbl t11
			LEFT JOIN t_check_tbl t21 ON t11.check_id = t21.id
			LEFT JOIN t_check_part_tbl tcp ON t11.part_id = tcp.id
			LEFT JOIN t_rectification_tbl t31 ON t11.check_id = t31.check_id
			LEFT JOIN company_view t41 ON t21.user_id = t41.user_id
			WHERE
			t21.del = 0 AND t21.status = 2 AND t11.status &gt; 1 AND t41.is_del = '0'
			<if test="flag != null">
				and t21.flag = #{flag}
			</if>
			GROUP BY t41.user_id
			) T6

			ON T1.`user_id` = T6.user_id
		</if>

		<where>
			T1.is_del = '0'
			<if test="companyName != null and companyName != ''">
				and T1.name LIKE CONCAT('%', #{companyName},'%')
			</if>
			<if test="villageName != null and villageName != ''">
				and T1.village_name LIKE CONCAT('%', #{villageName},'%')
			</if>
			<if test="coType != null and coType != ''">
				and T1.industry = #{coType}
			</if>
			<if test="villageId != null">
				and T1.village_id = #{villageId}
			</if>
			<if test="districtId != null">
				and T1.district_id = #{districtId}
			</if>
			<if test="townId != null">
				and T1.town_id = #{townId}
			</if>
			<if test="tradeId != null">
				and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
				#{tradeId} )
			</if>
			<if test="isFreeze != null and isFreeze != ''">
				and T2.is_freeze = #{isFreeze}
			</if>
			<if test="dlevel != null and dlevel != ''">
				and T1.dlevel in (${dlevel})
			</if>
			<if test="key1 != null">
				and T3.key1 = #{key1}
			</if>
			<if test="key2 != null">
				and T3.key2 = #{key2}
			</if>
			<if test="key3 != null">
				and T3.key3 = #{key3}
			</if>
			<if test="key4 != null">
				and T3.key4 = #{key4}
			</if>
			<if test="danger != null">
				and T1.danger = #{danger}
			</if>
			<if test="hazard != null">
				and T1.hazard = #{hazard}
			</if>
			<if test="isKey != null and isKey !='' or isKey==0">
				and T1.is_key = #{isKey}
			</if>
			<if test="cisDanger != null and cisDanger != ''">
				and T4.cis_danger = #{cisDanger}
			</if>
			<if test="doubleDanger != null and doubleDanger != ''">
				<!-- and (T4.cis_danger = 1 or T1.dlevel in ("A","B") or T1.industry 
					= '化工企业（危险化学品）生产、经营、使用、加油站') -->
				<!-- and T1.dlevel in ("红色","橙色") -->
				and (T1.industry = '化工企业（危险化学品生产、经营、使用）、加油站' or T1.danger = 1)
			</if>
		</where>
		group by T1.user_id
		<if test="isTradeKey != null and isTradeKey != ''">
			HAVING tradeKey = #{isTradeKey}
		</if>
		<choose>
			<when test="districtId != null"> order by key2 desc, userId desc</when>
			<when test="townId != null"> order by key1 desc, userId desc</when>
			<when test="villageId != null"> order by isKey desc, userId desc</when>
			<when test="user_id != null"> order by T1.user_id desc</when>
		</choose>
		<if test="page != null and limit != null">
			limit #{page},#{limit}
		</if>
	</select>

	<select id="selectByCompany_trade" resultType="java.lang.Integer">
		SELECT
		uid , (select is_del from user_tbl where id = T1.uid) isDel
		FROM
		trade_company_tbl T1
		WHERE
		T1.tid = #{tradeId}
		<if test="companyName != null and companyName != ''">
			and T1.uid in
			(select user_id from company_tbl
			where name LIKE CONCAT('%', #{companyName},'%') )
		</if>
		having isDel = 0
	</select>

	<select id="selectAllCompany" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from company_tbl T1
	</select>

	<select id="selectByCompany_view" resultType="java.lang.Integer">
		select
		user_id
		from
		company_view T1
		<where>
			T1.is_del = 0
			<if test="companyName != null and companyName != ''">
				and T1.name LIKE CONCAT('%', #{companyName},'%')
			</if>
			<if test="industry2 != null and industry2 != ''">
				and T1.industry2 like CONCAT(#{industry2}, '%')
			</if>
			<if test="villageId != null">
				and T1.village_id = #{villageId}
			</if>
			<if test="villageName != null and villageName != ''">
				and T1.village_name LIKE CONCAT('%', #{villageName},'%')
			</if>
			<if test="districtId != null">
				and T1.district_id = #{districtId}
			</if>
			<if test="townId != null">
				and T1.town_id = #{townId}
			</if>
		</where>
	</select>

	<select id="selectIdsByCompany_view" resultType="java.lang.Integer">
		select
		T1.user_id
		from company_view T1
		<where>
			T1.is_del = '0'
			<if test="industry != null and industry != ''">
				and T1.industry = #{industry}
			</if>
			<if test="industry2 != null and industry2 != ''">
				and T1.industry2 like CONCAT(#{industry2}, '%')
			</if>
			<if test="userId != null">
				and T1.user_id = #{userId}
			</if>
			<if test="villageId != null">
				and T1.village_id = #{villageId}
			</if>
			<if test="townId != null">
				and T1.town_id = #{townId}
			</if>
			<if test="districtId != null">
				and T1.district_id = #{districtId}
			</if>
			<if test="tradeId != null">
				and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
				#{tradeId}
				<if test="isTradeKey != null">
					and tradeKey = #{isTradeKey}
				</if>
				)
			</if>
			<if test="dlevel != null and dlevel != ''">
				and T1.dlevel in (${dlevel})
			</if>
			<if test="danger != null">
				and T1.danger = #{danger}
			</if>
			<if test="hazard != null">
				and T1.hazard = #{hazard}
			</if>
			<if test="isKey != null">
				and T1.is_key = #{isKey}
			</if>
			<if test="doubleDanger != null and doubleDanger != ''">
				and (T1.industry = '化工企业（危险化学品生产、经营、使用）、加油站' or T1.danger = 1)
			</if>

			<if test="isFreeze != null and isFreeze != ''">
				<if test="isFreeze == 0">
					AND T1.user_id NOT IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
				<if test="isFreeze == 1">
					AND T1.user_id IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
			</if>
			<if test="key1 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key1 =
				#{key1})
			</if>
			<if test="key2 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key2 =
				#{key2})
			</if>
			<if test="key3 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key3 =
				#{key3})
			</if>
			<if test="key4 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key4 =
				#{key4})
			</if>
			<if test="companyName != null and companyName != ''">
				and T1.name LIKE CONCAT('%', #{companyName},'%')
			</if>
			<if test="cisDanger != null and cisDanger != ''">
				and T1.user_id in (select user_id from regulation_tbl where cis_danger
				= #{cisDanger})
			</if>
		</where>
	</select>

	<select id="selectIdsByCompany_viewWithPage_1" resultType="java.util.HashMap">
		select
		<!-- SQL_CALC_FOUND_ROWS -->
		T1.*
		from company_tbl T1 left join user_tbl T2 on (T1.user_id = T2.id)
		<where>
			T2.is_del = '0'
			<!-- T1.is_del = '0' -->
			<if test="industry != null and industry != ''">
				and T1.industry = #{industry}
			</if>
			<if test="industry2 != null and industry2 != ''">
				and T1.industry2 like CONCAT(#{industry2}, '%')
			</if>
			<if test="userId != null">
				and T1.user_id = #{userId}
			</if>
			<if test="villageId != null">
				and T1.village_id = #{villageId}
			</if>
			<if test="townId != null">
				and T1.town_id = #{townId}
			</if>
			<if test="districtId != null">
				and T1.district_id = #{districtId}
			</if>
			<if test="tradeId != null">
				and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
				#{tradeId}
				<if test="isTradeKey != null">
					and tradeKey = #{isTradeKey}
				</if>
				)
			</if>
			<if test="dlevel != null and dlevel != ''">
				and T1.dlevel in (${dlevel})
			</if>
			<if test="danger != null">
				and T1.danger = #{danger}
			</if>
			<if test="hazard != null">
				and T1.hazard = #{hazard}
			</if>
			<if test="isKey != null">
				and T1.is_key = #{isKey}
			</if>
			<if test="doubleDanger != null and doubleDanger != ''">
				and (T1.industry = '化工企业（危险化学品生产、经营、使用）、加油站' or T1.danger = 1)
			</if>

			<if test="isFreeze != null and isFreeze != ''">
				<if test="isFreeze == 0">
					AND T1.user_id NOT IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
				<if test="isFreeze == 1">
					AND T1.user_id IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
			</if>
			<if test="key1 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key1 =
				#{key1})
			</if>
			<if test="key2 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key2 =
				#{key2})
			</if>
			<if test="key3 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key3 =
				#{key3})
			</if>
			<if test="key4 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key4 =
				#{key4})
			</if>
			<if test="companyName != null and companyName != ''">
				and T1.name LIKE CONCAT('%', #{companyName},'%')
			</if>
			<if test="villageName != null and villageName != ''">
				and T1.village_name LIKE CONCAT('%', #{villageName},'%')
			</if>
			<if test="cisDanger != null and cisDanger != ''">
				and T1.user_id in (select user_id from regulation_tbl where cis_danger
				= #{cisDanger})
			</if>
		</where>
		<if test="rows != null">
			limit #{index}, #{rows}
		</if>
	</select>

	<select id="selectIdsByCompany_viewWithPage" resultType="java.lang.Integer">
		select
		T1.user_id
		from company_view T1
		<where>
			T1.is_del = '0'
			<if test="industry != null and industry != ''">
				and T1.industry = #{industry}
			</if>
			<if test="industry2 != null and industry2 != ''">
				and T1.industry2 like CONCAT(#{industry2}, '%')
			</if>
			<if test="userId != null">
				and T1.user_id = #{userId}
			</if>
			<if test="villageId != null">
				and T1.village_id = #{villageId}
			</if>
			<if test="townId != null">
				and T1.town_id = #{townId}
			</if>
			<if test="districtId != null">
				and T1.district_id = #{districtId}
			</if>
			<if test="tradeId != null">
				and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
				#{tradeId}
				<if test="isTradeKey != null">
					and tradeKey = #{isTradeKey}
				</if>
				)
			</if>
			<if test="dlevel != null and dlevel != ''">
				and T1.dlevel in (${dlevel})
			</if>
			<if test="danger != null">
				and T1.danger = #{danger}
			</if>
			<if test="hazard != null">
				and T1.hazard = #{hazard}
			</if>
			<if test="isKey != null">
				and T1.is_key = #{isKey}
			</if>
			<if test="doubleDanger != null and doubleDanger != ''">
				and (T1.industry = '化工企业（危险化学品生产、经营、使用）、加油站' or T1.danger = 1)
			</if>

			<if test="isFreeze != null and isFreeze != ''">
				<if test="isFreeze == 0">
					AND T1.user_id NOT IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
				<if test="isFreeze == 1">
					AND T1.user_id IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
			</if>
			<if test="key1 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key1 =
				#{key1})
			</if>
			<if test="key2 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key2 =
				#{key2})
			</if>
			<if test="key3 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key3 =
				#{key3})
			</if>
			<if test="key4 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key4 =
				#{key4})
			</if>
			<if test="companyName != null and companyName != ''">
				and T1.name LIKE CONCAT('%', #{companyName},'%')
			</if>
			<if test="villageName != null and villageName != ''">
				and T1.village_name LIKE CONCAT('%', #{villageName},'%')
			</if>
			<if test="cisDanger != null and cisDanger != ''">
				and T1.user_id in (select user_id from regulation_tbl where cis_danger
				= #{cisDanger})
			</if>
		</where>
		<if test="rows != null">
			limit #{index}, #{rows}
		</if>
	</select>

	<select id="selectIdsByCompany_view_count_1" resultType="java.lang.Integer">
		select count(0)
		from company_tbl T1 left join user_tbl T2 on (T1.user_id = T2.id)
		<where>
			T2.is_del = '0'
			<!-- T1.is_del = '0' -->
			<if test="industry != null and industry != ''">
				and T1.industry = #{industry}
			</if>
			<if test="industry2 != null and industry2 != ''">
				and T1.industry2 like CONCAT(#{industry2}, '%')
			</if>
			<if test="userId != null">
				and T1.user_id = #{userId}
			</if>
			<if test="villageId != null">
				and T1.village_id = #{villageId}
			</if>
			<if test="townId != null">
				and T1.town_id = #{townId}
			</if>
			<if test="districtId != null">
				and T1.district_id = #{districtId}
			</if>
			<if test="tradeId != null">
				and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
				#{tradeId}
				<if test="isTradeKey != null">
					and tradeKey = #{isTradeKey}
				</if>
				)
			</if>
			<if test="dlevel != null and dlevel != ''">
				and T1.dlevel in (${dlevel})
			</if>
			<if test="danger != null">
				and T1.danger = #{danger}
			</if>
			<if test="hazard != null">
				and T1.hazard = #{hazard}
			</if>
			<if test="isKey != null">
				and T1.is_key = #{isKey}
			</if>
			<if test="doubleDanger != null and doubleDanger != ''">
				and (T1.industry = '化工企业（危险化学品生产、经营、使用）、加油站' or T1.danger = 1)
			</if>

			<if test="isFreeze != null and isFreeze != ''">
				<if test="isFreeze == 0">
					AND T1.user_id NOT IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
				<if test="isFreeze == 1">
					AND T1.user_id IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
			</if>
			<if test="key1 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key1 =
				#{key1})
			</if>
			<if test="key2 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key2 =
				#{key2})
			</if>
			<if test="key3 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key3 =
				#{key3})
			</if>
			<if test="key4 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key4 =
				#{key4})
			</if>
			<if test="companyName != null and companyName != ''">
				and T1.name LIKE CONCAT('%', #{companyName},'%')
			</if>
			<if test="villageName != null and villageName != ''">
				and T1.village_name LIKE CONCAT('%', #{villageName},'%')
			</if>
			<if test="cisDanger != null and cisDanger != ''">
				and T1.user_id in (select user_id from regulation_tbl where cis_danger
				= #{cisDanger})
			</if>
		</where>

	</select>

	<select id="selectIdsByCompany_view_count" resultType="java.lang.Integer">
		select
		count(0)
		from company_view T1
		<where>
			T1.is_del = '0'
			<if test="industry != null and industry != ''">
				and T1.industry = #{industry}
			</if>
			<if test="industry2 != null and industry2 != ''">
				and T1.industry2 like CONCAT(#{industry2}, '%')
			</if>
			<if test="userId != null">
				and T1.user_id = #{userId}
			</if>
			<if test="villageId != null">
				and T1.village_id = #{villageId}
			</if>
			<if test="townId != null">
				and T1.town_id = #{townId}
			</if>
			<if test="districtId != null">
				and T1.district_id = #{districtId}
			</if>
			<if test="tradeId != null">
				and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
				#{tradeId}
				<if test="isTradeKey != null">
					and tradeKey = #{isTradeKey}
				</if>
				)
			</if>
			<if test="dlevel != null and dlevel != ''">
				and T1.dlevel in (${dlevel})
			</if>
			<if test="danger != null">
				and T1.danger = #{danger}
			</if>
			<if test="hazard != null">
				and T1.hazard = #{hazard}
			</if>
			<if test="isKey != null">
				and T1.is_key = #{isKey}
			</if>
			<if test="doubleDanger != null and doubleDanger != ''">
				and (T1.industry = '化工企业（危险化学品生产、经营、使用）、加油站' or T1.danger = 1)
			</if>

			<if test="isFreeze != null and isFreeze != ''">
				<if test="isFreeze == 0">
					AND T1.user_id NOT IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
				<if test="isFreeze == 1">
					AND T1.user_id IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
			</if>
			<if test="key1 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key1 =
				#{key1})
			</if>
			<if test="key2 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key2 =
				#{key2})
			</if>
			<if test="key3 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key3 =
				#{key3})
			</if>
			<if test="key4 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key4 =
				#{key4})
			</if>
			<if test="companyName != null and companyName != ''">
				and T1.name LIKE CONCAT('%', #{companyName},'%')
			</if>
			<if test="villageName != null and villageName != ''">
				and T1.village_name LIKE CONCAT('%', #{villageName},'%')
			</if>
			<if test="scale != null and scale != ''">
				and T1.scale = #{scale}
			</if>
			<if test="cisDanger != null and cisDanger != ''">
				and T1.user_id in (select user_id from regulation_tbl where cis_danger
				= #{cisDanger})
			</if>
		</where>
	</select>

	<select id="selectByIds" resultType="java.util.HashMap">
		select
		T1.user_id userId,
		T1.name, T1.industry, T1.industry2, T1.scale, T1.dlevel, T1.address, T1.is_key
		isKey, T1.dangers, T1.charge,
		T1.is_freeze isFreeze, T1.village_name villageName, T1.town_name townName,
		<if test="tradeId != null">
			(SELECT iskey FROM trade_company_tbl WHERE tid = ${tradeId} and uid =
			T1.user_id limit 1) tradeKey,
			(SELECT id FROM trade_company_tbl WHERE tid = ${tradeId} and uid =
			T1.user_id limit 1) tradeCompanyId,
		</if>
		(select
		COUNT(0) from a_company_manual_tbl T4
		where
		T4.del = 0 and T4.uid = T1.user_id
		) count,
		(select region_name from global_region_view where id = T1.region_id)
		regionName,
		T3.key1, T3.key2, T3.key3, T3.key4
		from
		(select * from company_view
		<where>
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		)
		T1
		left join company_iskey_tbl T3 on T1.user_id = T3.user_id
	</select>
	<select id="selectByDTO" resultType="java.util.HashMap">
		select
		T1.user_id userId,
		T1.name, T1.industry, T1.industry2, T1.scale, T1.dlevel, T1.address, T1.is_key
		isKey, T1.dangers, T1.charge,
		T1.is_freeze isFreeze, T1.village_name villageName, T1.town_name townName,
		<if test="tradeId != null">
			(SELECT iskey FROM trade_company_tbl WHERE tid = ${tradeId} and uid =
			T1.user_id limit 1) tradeKey,
			(SELECT id FROM trade_company_tbl WHERE tid = ${tradeId} and uid =
			T1.user_id limit 1) tradeCompanyId,
		</if>
		(select
		COUNT(0) from a_company_manual_tbl T4
		where
		T4.del = 0 and T4.uid = T1.user_id
		) count,
		(select region_name from global_region_view where id = T1.region_id)
		regionName,
		T3.key1, T3.key2, T3.key3, T3.key4
		from
		(select * from company_view
		<where>
			<if test="userIds != null and userIds != ''">and user_id in (${userIds})</if>
		</where>
		)
		T1
		left join company_iskey_tbl T3 on T1.user_id = T3.user_id
		<where>
			T1.is_del = '0'
			<if test="industry != null and industry != ''">
				and T1.industry = #{industry}
			</if>
			<if test="industry2 != null and industry2 != ''">
				and T1.industry2 like CONCAT(#{industry2}, '%')
			</if>
			<if test="userId != null">
				and T1.user_id = #{userId}
			</if>
			<if test="villageId != null">
				and T1.village_id = #{villageId}
			</if>
			<if test="townId != null">
				and T1.town_id = #{townId}
			</if>
			<if test="districtId != null">
				and T1.district_id = #{districtId}
			</if>
			<if test="tradeId != null">
				and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
				#{tradeId}
				<if test="isTradeKey != null">
					and tradeKey = #{isTradeKey}
				</if>
				)
			</if>
			<if test="dlevel != null and dlevel != ''">
				and T1.dlevel in (${dlevel})
			</if>
			<if test="danger != null">
				and T1.danger = #{danger}
			</if>
			<if test="hazard != null">
				and T1.hazard = #{hazard}
			</if>
			<if test="isKey != null">
				and T1.is_key = #{isKey}
			</if>
			<if test="doubleDanger != null and doubleDanger != ''">
				and (T1.industry = '化工企业（危险化学品生产、经营、使用）、加油站' or T1.danger = 1)
			</if>

			<if test="isFreeze != null and isFreeze != ''">
				<if test="isFreeze == 0">
					AND T1.user_id NOT IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
				<if test="isFreeze == 1">
					AND T1.user_id IN (SELECT
					T4.uid
					FROM
					a_company_manual_tbl T4
					WHERE
					T4.del = 0)
				</if>
			</if>
			<if test="key1 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key1 =
				#{key1})
			</if>
			<if test="key2 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key2 =
				#{key2})
			</if>
			<if test="key3 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key3 =
				#{key3})
			</if>
			<if test="key4 != null">
				and T1.user_id in (select user_id from company_iskey_tbl where key4 =
				#{key4})
			</if>
			<if test="companyName != null and companyName != ''">
				and T1.name LIKE CONCAT('%', #{companyName},'%')
			</if>
			<if test="villageName != null and villageName != ''">
				and T1.village_name LIKE CONCAT('%', #{villageName},'%')
			</if>
			<if test="scale != null and scale != ''">
				and T1.scale = #{scale}
			</if>
			<if test="cisDanger != null and cisDanger != ''">
				and T1.user_id in (select user_id from regulation_tbl where cis_danger
				= #{cisDanger})
			</if>
		</where>
	</select>
	<select id="selectUseridsForSource" resultType="java.lang.Integer">
		select
		T1.user_id
		from company_view T1
		left join regulation_tbl T2 on T1.user_id = T2.user_id
		<where>
			T1.is_del = '0' 
			and T1.user_id in (select user_id from monitor_tbl where del =0 
				<if test="companyName != null and companyName != ''">
         			and T2.name LIKE CONCAT('%', #{companyName},'%')
        		</if>
        	)
			<if test="villageId != null">
				and T1.village_id = #{villageId}
			</if>
			<if test="townId != null">
				and T1.town_id = #{townId}
			</if>
			<if test="districtId != null">
				and T1.district_id = #{districtId}
			</if>
			<if test="tradeId != null">
				and T1.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId}
					<if test="isTradeKey != null">
						and tradeKey = #{isTradeKey}
					</if>
				)
			</if>
			<if test="cisDanger != null and cisDanger != ''">
				and T2.cis_danger = #{cisDanger}
			</if>
			<if test="chemic != null and chemic != ''">
				and T2.chemic = #{chemic}
			</if>
		</where>
	</select>
</mapper>
