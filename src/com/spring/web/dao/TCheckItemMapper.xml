<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.web.dao.TCheckItemMapper">
    <resultMap id="BaseResultMap" type="com.spring.web.model.TCheckItem">
        <constructor>
            <idArg column="id" javaType="java.lang.Integer" jdbcType="INTEGER"/>
            <arg column="content" javaType="java.lang.String" jdbcType="VARCHAR"/>
            <arg column="level_id" javaType="java.lang.Integer" jdbcType="INTEGER"/>
            <arg column="levels" javaType="java.lang.String" jdbcType="VARCHAR"/>
            <arg column="reference" javaType="java.lang.String" jdbcType="VARCHAR"/>
            <arg column="part_id" javaType="java.lang.Integer" jdbcType="INTEGER"/>
            <arg column="check_id" javaType="java.lang.Integer" jdbcType="INTEGER"/>
            <arg column="status" javaType="java.lang.Integer" jdbcType="INTEGER"/>
            <arg column="memo" javaType="java.lang.String" jdbcType="VARCHAR"/>
            <arg column="files" javaType="java.lang.String" jdbcType="VARCHAR"/>
            <arg column="suggest" javaType="java.lang.Integer" jdbcType="INTEGER"/>
            <arg column="deadline" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
            <arg column="plan_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
            <arg column="recheck_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
            <arg column="recheck_file" javaType="java.lang.String" jdbcType="VARCHAR"/>
            <arg column="recheck_memo" javaType="java.lang.String" jdbcType="VARCHAR"/>
            <arg column="file_address" javaType="java.lang.String" jdbcType="VARCHAR"/>
            <arg column="money" javaType="java.math.BigDecimal" jdbcType="DECIMAL"/>
        </constructor>
    </resultMap>
    <sql id="Base_Column_List">
        id, content, level_id, levels, reference, part_id, check_id, status, memo, files,
        suggest, deadline, plan_time, recheck_time, recheck_file, recheck_memo,file_address,money
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from t_check_item_tbl
        where id = #{id,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        delete from t_check_item_tbl
        where id = #{id,jdbcType=INTEGER}
    </delete>
    <insert id="insert" parameterType="com.spring.web.model.TCheckItem">
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into t_check_item_tbl (content, level_id, levels,
        reference, part_id, check_id,
        status, memo, files,
        suggest, deadline, plan_time,
        recheck_time, recheck_file, recheck_memo,file_address,money
        )
        values (#{content,jdbcType=VARCHAR}, #{levelId,jdbcType=INTEGER}, #{levels,jdbcType=VARCHAR},
        #{reference,jdbcType=VARCHAR}, #{partId,jdbcType=INTEGER}, #{checkId,jdbcType=INTEGER},
        #{status,jdbcType=INTEGER}, #{memo,jdbcType=VARCHAR}, #{files,jdbcType=VARCHAR},
        #{suggest,jdbcType=INTEGER}, #{deadline,jdbcType=TIMESTAMP}, #{planTime,jdbcType=TIMESTAMP},
        #{recheckTime,jdbcType=TIMESTAMP}, #{recheckFile,jdbcType=VARCHAR}, #{recheckMemo,jdbcType=VARCHAR}
        #{fileAddress,jdbcType=VARCHAR},#{money,jdbcType=DECIMAL}
        )
    </insert>
    <insert id="insertSelective" parameterType="com.spring.web.model.TCheckItem">
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into t_check_item_tbl
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="content != null">
                content,
            </if>
            <if test="levelId != null">
                level_id,
            </if>
            <if test="levels != null">
                levels,
            </if>
            <if test="reference != null">
                reference,
            </if>
            <if test="partId != null">
                part_id,
            </if>
            <if test="checkId != null">
                check_id,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="memo != null">
                memo,
            </if>
            <if test="files != null">
                files,
            </if>
            <if test="suggest != null">
                suggest,
            </if>
            <if test="deadline != null">
                deadline,
            </if>
            <if test="planTime != null">
                plan_time,
            </if>
            <if test="recheckTime != null">
                recheck_time,
            </if>
            <if test="recheckFile != null">
                recheck_file,
            </if>
            <if test="recheckMemo != null">
                recheck_memo,
            </if>
            <if test="fileAddress != null">
                file_address,
            </if>
            <if test="money != null">
                money,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="content != null">
                #{content,jdbcType=VARCHAR},
            </if>
            <if test="levelId != null">
                #{levelId,jdbcType=INTEGER},
            </if>
            <if test="levels != null">
                #{levels,jdbcType=VARCHAR},
            </if>
            <if test="reference != null">
                #{reference,jdbcType=VARCHAR},
            </if>
            <if test="partId != null">
                #{partId,jdbcType=INTEGER},
            </if>
            <if test="checkId != null">
                #{checkId,jdbcType=INTEGER},
            </if>
            <if test="status != null">
                #{status,jdbcType=INTEGER},
            </if>
            <if test="memo != null">
                #{memo,jdbcType=VARCHAR},
            </if>
            <if test="files != null">
                #{files,jdbcType=VARCHAR},
            </if>
            <if test="suggest != null">
                #{suggest,jdbcType=INTEGER},
            </if>
            <if test="deadline != null">
                #{deadline,jdbcType=TIMESTAMP},
            </if>
            <if test="planTime != null">
                #{planTime,jdbcType=TIMESTAMP},
            </if>
            <if test="recheckTime != null">
                #{recheckTime,jdbcType=TIMESTAMP},
            </if>
            <if test="recheckFile != null">
                #{recheckFile,jdbcType=VARCHAR},
            </if>
            <if test="recheckMemo != null">
                #{recheckMemo,jdbcType=VARCHAR},
            </if>
            <if test="fileAddress != null">
                #{file_address,jdbcType=VARCHAR},
            </if>
            <if test="money != null">
                #{money,jdbcType=DECIMAL},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.spring.web.model.TCheckItem">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_check_item_tbl
        <set>
            <if test="content != null">
                content = #{content,jdbcType=VARCHAR},
            </if>
            <if test="levelId != null">
                level_id = #{levelId,jdbcType=INTEGER},
            </if>
            <if test="levels != null">
                levels = #{levels,jdbcType=VARCHAR},
            </if>
            <if test="reference != null">
                reference = #{reference,jdbcType=VARCHAR},
            </if>
            <if test="partId != null">
                part_id = #{partId,jdbcType=INTEGER},
            </if>
            <if test="checkId != null">
                check_id = #{checkId,jdbcType=INTEGER},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=INTEGER},
            </if>
            <if test="memo != null">
                memo = #{memo,jdbcType=VARCHAR},
            </if>
            <if test="files != null">
                files = #{files,jdbcType=VARCHAR},
            </if>
            <if test="suggest != null">
                suggest = #{suggest,jdbcType=INTEGER},
            </if>
            <if test="deadline != null">
                deadline = #{deadline,jdbcType=TIMESTAMP},
            </if>
            <if test="planTime != null">
                plan_time = #{planTime,jdbcType=TIMESTAMP},
            </if>
            <if test="recheckTime != null">
                recheck_time = #{recheckTime,jdbcType=TIMESTAMP},
            </if>
            <if test="recheckFile != null">
                recheck_file = #{recheckFile,jdbcType=VARCHAR},
            </if>
            <if test="recheckMemo != null">
                recheck_memo = #{recheckMemo,jdbcType=VARCHAR},
            </if>
            <if test="fileAddress != null">
                file_address = #{fileAddress,jdbcType=VARCHAR},
            </if>
            <if test="money != null">
                money = #{money,jdbcType=DECIMAL}
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.spring.web.model.TCheckItem">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_check_item_tbl
        set content = #{content,jdbcType=VARCHAR},
        level_id = #{levelId,jdbcType=INTEGER},
        levels = #{levels,jdbcType=VARCHAR},
        reference = #{reference,jdbcType=VARCHAR},
        part_id = #{partId,jdbcType=INTEGER},
        check_id = #{checkId,jdbcType=INTEGER},
        status = #{status,jdbcType=INTEGER},
        memo = #{memo,jdbcType=VARCHAR},
        files = #{files,jdbcType=VARCHAR},
        suggest = #{suggest,jdbcType=INTEGER},
        deadline = #{deadline,jdbcType=TIMESTAMP},
        plan_time = #{planTime,jdbcType=TIMESTAMP},
        recheck_time = #{recheckTime,jdbcType=TIMESTAMP},
        recheck_file = #{recheckFile,jdbcType=VARCHAR},
        recheck_memo = #{recheckMemo,jdbcType=VARCHAR},
        file_address = #{fileAddress,jdbcType=VARCHAR},
        money = #{money,jdbcType=DECIMAL}
        where id = #{id,jdbcType=INTEGER}
    </update>

    <insert id="insertBath">
        insert into t_check_item_tbl (content, level_id, levels, reference, part_id,
        check_id, status)
        values
        <foreach close="" collection="list" index="" item="item" open="" separator=",">
            (#{item.content}, #{item.levelId}, #{item.levels} ,#{item.reference}, ${partId},
            ${checkId}, 1)
        </foreach>
    </insert>

    <insert id="insertThreeBath">
        insert into t_check_item_tbl (content, level_id, levels, reference, part_id,
        check_id, status, memo, files)
        values
        <foreach close="" collection="list" index="" item="item" open="" separator=",">
            (#{item.content}, #{item.levelId}, #{item.levels} ,#{item.reference}, ${partId},
            ${checkId}, #{item.status}, #{item.memo}, #{item.files})
        </foreach>
    </insert>

    <!--
        根据checkid(检查记录id获取数据)并进行显示和数据
    -->
    <select id="selectByCheckId" resultType="java.util.Map">
        select
        <!--zhangcl 2018.10.28  T1.id, T1.content, T1.reference, T1.part_id partId, T1.check_id checkId, T1.status, T1.memo, T1.files, T1.memo,-->
        T1.id, T1.level_id levelId, T1.content, T1.reference, T1.part_id partId, T1.check_id checkId, T1.status,
        T1.memo, T1.files, T1.memo,
        T1.levels, T2.name
        from
        t_check_item_tbl T1
        left join t_check_part_tbl T2 on T2.id = T1.part_id
        where
        T1.check_id = #{checkId}
        order by T2.name;

    </select>

    <select id="selectAllLevelId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select *
        from
        t_check_item_tbl
        where
        check_id = #{checkId}
    </select>

    <select id="selectByAppCheckId" resultType="java.util.Map">
    select 
       T1.id, T1.content, T1.reference, T1.part_id partId, T1.check_id checkId, T1.status, T1.memo, T1.files, T1.memo, T1.level_id levelId,
       T2.level1, T2.level2, T2.level3
    from 
      t_check_item_tbl T1
    left join
      t_level_tbl T2 on T1.level_id = T2.id
    where
      check_id = #{checkId}
      group by part_id , level_id
  </select>

    <select id="selectByAppList" resultType="java.util.Map">
        select
        T1.id, T1.content, T1.reference, T1.part_id partId, T1.check_id checkId, T1.status, T1.memo, T1.files, T1.memo,
        T1.level_id levelId,
        T2.level1, T2.level2, T2.level3
        from
        t_check_item_tbl T1
        left join
        t_level_tbl T2 on T1.level_id = T2.id
        <where>
            <if test="partId != null and partId != ''">
                T1.part_id = #{partId}
            </if>
            <if test="levelId != null and levelId != ''">
                and T2.level1 = (select level1 from t_level_tbl where id = #{levelId})
            </if>
        </where>
        order by T1.id desc
    </select>

    <select id="selectByList3" resultType="java.util.Map">
        select
        T1.id, T1.content, T1.reference, T1.part_id partId, T1.check_id checkId, T1.status, T1.memo, T1.files, T1.memo,
        T1.level_id levelId,
        T2.level1, T2.level2, T2.level3
        from
        t_check_item_tbl T1
        left join
        t_level_tbl T2 on T1.level_id = T2.id
        <where>
            <if test="checkId != null and checkId != ''">
                T1.check_id = #{checkId}
            </if>
            <if test="partId != null and partId != ''">
                and T1.part_id = #{partId}
            </if>
            <if test="levelId != null and levelId != ''">
                and T1.level_id = #{levelId}
            </if>
            and T1.status &gt; 1
        </where>
        order by T1.id desc
    </select>

    <select id="selectByMap1" resultType="java.util.Map"> <!--   zhangcl 2018.12.29 -->
        select
        T1.id, T1.reference, T1.part_id partId, T1.check_id checkId, T1.status, T1.files, T1.memo, T1.level_id levelId,
        T2.level1, T2.level2, T2.level3,T2.type,T2.factors,T2.measures ,T2.measures as content
        from
        t_check_item_tbl T1
        left join
        a_danger_manual_tbl T2 on T1.level_id = T2.id
        <where>
            <if test="checkId != null and checkId != ''">
                T1.check_id = #{checkId}
            </if>
            <if test="partId != null and partId != ''">
                and T1.part_id = #{partId}
            </if>
            <if test="levelId != null and levelId != ''">
                and T1.level_id = #{levelId}
            </if>
        </where>
        order by T1.id desc
    </select>

    <!--复查,查询不合格项并返回

    -->
    <select id="selectDangerByCheckId" resultType="java.util.Map">
        select
        T1.id, T1.content, T1.reference, T1.status, T1.memo, T1.files, T1.level_id levelId, T1.part_id partId,
        T1.suggest, T1.deadline, T1.recheck_time recheckTime, T1.recheck_file recheckFile, T1.plan_time planTime,
        T1.levels, (select level1 from t_level_tbl where id = T1.level_id) level1,
        T3.name partName, T4.depart, T3.part_img partImg, T4.type, T4.industry_type
        from
        t_check_item_tbl T1
        left join
        t_check_part_tbl T3 on T1.part_id = T3.id
        left join
        t_check_tbl T4 on T1.check_id = T4.id
        where
        T1.check_id = #{checkId}
        <choose>
            <when test="status != null and status != ''">
                and T1.status = #{status}
            </when>
            <otherwise>
                and T1.status > 1
            </otherwise>
        </choose>
        order by T3.name
    </select>

    <update id="updSuggest">
    update t_check_item_tbl
    set 
      suggest = #{suggest},
      deadline = #{deadline},
      plan_time = #{planTime}
    where id in (${ids})
  </update>

    <update id="updRecheck">
        update t_check_item_tbl
        set
        status = #{status},
        <if test="deadline != null">
            deadline = #{deadline},
        </if>
        <if test="planTime != null">
            plan_time = #{planTime},
        </if>
        <![CDATA[recheck_file = (select group_concat(file) from t_recheck_item_tbl where check_item_id = #{id} and file != '' and file is not null),
      recheck_memo = (select group_concat(memo SEPARATOR '</br>') from t_recheck_item_tbl where check_item_id = #{id} and memo != '' and memo is not null),
      ]]>
        recheck_time = #{recheckTime}
        where id = #{id}
    </update>

    <delete id="deleteByCheckId">
    delete from t_check_item_tbl
    where check_id = #{checkId}
  </delete>

    <select id="selectCount" resultType="java.util.Map">
        select
        count(0) c, flag, status
        from
        t_check_item_view2 T4
        <where>
            <if test="userId != null">
                and user_id = ${userId}
            </if>
            <if test="userIds != null">
                and user_id in (${userIds})
            </if>
            <if test="villageId != null">
                and village_id = ${villageId}
            </if>
            <if test="townId != null">
                and town_id = ${townId}
            </if>
            <if test="districtId != null">
                and district_id = ${districtId}
            </if>
            <if test="tradeId != null">
                and user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
        </where>
        group by flag, status
    </select>

    <select id="selectCount2" resultType="java.util.Map">
        select
        count(0) c, flag, status, d
        from
        t_check_item_view2 T4
        <where>
            <if test="userId != null">
                and user_id = ${userId}
            </if>
            <if test="villageId != null">
                and village_id = ${villageId}
            </if>
            <if test="townId != null">
                and town_id = ${townId}
            </if>
            <if test="districtId != null">
                and district_id = ${districtId}
            </if>
            <if test="tradeId != null">
                and user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
        </where>
        group by flag, status, d
    </select>

    <select id="selectZhongCount" resultType="java.util.Map">
        select
        count(0) c, flag, status
        from
        t_check_item_view2
        <where>
            d = 1
            <if test="userId != null">
                and user_id = ${userId}
            </if>
            <if test="userIds != null">
                and user_id in (${userIds})
            </if>
            <if test="villageId != null">
                and village_id = ${villageId}
            </if>
            <if test="townId != null">
                and town_id = ${townId}
            </if>
            <if test="districtId != null">
                and district_id = ${districtId}
            </if>
            <if test="tradeId != null">
                and user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
        </where>
        group by flag, status
    </select>

    <select id="selectGroupIndustryType" resultType="com.spring.web.ibatis.DynamicParameter">
        SELECT
        count(0) c, DATE_FORMAT(real_time, '%Y-%m') time,
        case WHEN industry_type is not NULL and industry_type != '' THEN industry_type
        WHEN levels = '基础管理' THEN 1
        WHEN levels = '现场管理' THEN 2
        ELSE 2
        end t
        from
        t_check_item_view2
        <where>
            <![CDATA[DATE_FORMAT(real_time, '%Y-%m') >= #{startTime1} and DATE_FORMAT(real_time, '%Y-%m') <= #{endTime1}]]>
            <if test="userId != null">
                and user_id = ${userId}
            </if>
            <if test="villageId != null">
                and village_id = ${villageId}
            </if>
            <if test="townId != null">
                and town_id = ${townId}
            </if>
            <if test="districtId != null">
                and district_id = ${districtId}
            </if>
            <if test="tradeId != null">
                and user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
        </where>
        GROUP BY time, t
    </select>

    <select id="selectGroupItem3" resultType="com.spring.web.ibatis.DynamicParameter">
        SELECT
        count(0) c, DATE_FORMAT(real_time, '%Y-%m') time, d
        from
        t_check_item_view2
        <where>
            <![CDATA[DATE_FORMAT(real_time, '%Y-%m') >= #{startTime1} and DATE_FORMAT(real_time, '%Y-%m') <= #{endTime1}]]>
            <if test="userId != null">
                and user_id = ${userId}
            </if>
            <if test="villageId != null">
                and village_id = ${villageId}
            </if>
            <if test="townId != null">
                and town_id = ${townId}
            </if>
            <if test="districtId != null">
                and district_id = ${districtId}
            </if>
            <if test="tradeId != null">
                and user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
        </where>
        GROUP BY time, d
    </select>

    <select id="selectGroupItemStatus" resultType="com.spring.web.ibatis.DynamicParameter">
        SELECT
        count(0) c, DATE_FORMAT(real_time, '%Y-%m') time, status
        from
        t_check_item_view2
        <where>
            <![CDATA[ DATE_FORMAT(real_time, '%Y-%m') >= #{startTime1} and DATE_FORMAT(real_time, '%Y-%m') <= #{endTime1}]]>
            <if test="userId != null">
                and user_id = ${userId}
            </if>
            <if test="villageId != null">
                and village_id = ${villageId}
            </if>
            <if test="townId != null">
                and town_id = ${townId}
            </if>
            <if test="districtId != null">
                and district_id = ${districtId}
            </if>
            <if test="tradeId != null">
                and user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
        </where>
        GROUP BY time, status
    </select>
    <!--根据不同进行查询-->
    <select id="selectGroupFlag" resultType="com.spring.web.ibatis.DynamicParameter">
        SELECT
        count(0) c, DATE_FORMAT(real_time, '%Y-%m') time, flag
        from
        t_check_item_view2
        <where>
            <![CDATA[DATE_FORMAT(real_time, '%Y-%m') >= #{startTime1} and DATE_FORMAT(real_time, '%Y-%m') <= #{endTime1}]]>
            <if test="userId != null">
                and user_id = ${userId}
            </if>
            <if test="villageId != null">
                and village_id = ${villageId}
            </if>
            <if test="townId != null">
                and town_id = ${townId}
            </if>
            <if test="districtId != null">
                and district_id = ${districtId}
            </if>
            <if test="tradeId != null">
                and user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
        </where>
        GROUP BY time, flag
    </select>

    <select id="selectDangerIndexList" resultType="java.util.Map">
        select
        T4.name companyName, T2.real_time realTime,
        T1.id, T1.content, T1.reference, T1.status, T1.memo, T1.files,
        T1.levels,
        tcp.name partName,
        T2.depart, tcp.part_img partImg, T2.check_company checkCompany,
        T2.flag, T2.cheker,T2.industry_type industryType,
        IF(find_in_set(T1.id, T3.item3), 1, 0) AS d
        from
        t_check_item_tbl T1
        left join t_check_tbl T2 on T1.check_id = T2.id
        left join t_check_part_tbl tcp on T1.part_id = tcp.id
        left join t_rectification_tbl T3 on T1.check_id = T3.check_id
        left join company_view T4 on T2.user_id = T4.user_id
        <where>
            T2.del = 0 and T2.status = 2 and T1.status > 1 and T4.is_del = '0'
            <if test="flag != null">
                and T2.flag = #{flag}
            </if>
            <if test="userId != null">
                and T4.user_id = ${userId}
            </if>
            <if test="villageId != null">
                and T4.village_id = ${villageId}
            </if>
            <if test="townId != null">
                and T4.town_id = ${townId}
            </if>
            <if test="districtId != null">
                and T4.district_id = ${districtId}
            </if>
            <if test="tradeId != null">
                and T4.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
            <if test="companyName != null and companyName != ''">
                and T4.name LIKE CONCAT('%', #{companyName},'%')
            </if>
            <if test="partName != null and partName != ''">
                and T1.part_name LIKE CONCAT('%', #{partName},'%')
            </if>
            <if test="villageName != null and villageName != ''">
                and t4.village_name LIKE CONCAT('%', #{villageName},'%')
            </if>
            <if test="status != null and status != ''">
                and T1.status = #{status}
            </if>
            <if test="startTime != null and startTime != ''">
                and DATE_FORMAT(T2.real_time, '%Y-%m-%d') >= #{startTime}
            </if>
            <if test="endTime != null and endTime != ''">
                <![CDATA[and DATE_FORMAT(T2.real_time, '%Y-%m-%d') <= #{endTime}]]>
            </if>
        </where>
        <if test="d != null">
            having d = #{d}
        </if>
        order by T1.id desc, T2.real_time desc
    </select>

    <select id="selectDangerIndexListCount" resultType="java.lang.Integer">
        select
        count(0)
        from
        t_check_item_view2
        <where>
            <if test="flag != null">
                and flag = #{flag}
            </if>
            <if test="userId != null">
                and user_id = #{userId}
            </if>
            <if test="townId != null">
                and town_id = #{townId}
            </if>
            <if test="districtId != null">
                and district_id = #{districtId}
            </if>
            <if test="villageId != null">
                and village_id = #{villageId}
            </if>
            <if test="tradeId != null">
                and user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
            <if test="startTime != null and startTime != ''">
                and DATE_FORMAT(real_time, '%Y-%m-%d') >= #{startTime}
            </if>
            <if test="endTime != null and endTime != ''">
                <![CDATA[and DATE_FORMAT(real_time, '%Y-%m-%d') <= #{endTime}]]>
            </if>
            <if test="d != null">
                and d = #{d}
            </if>
            <if test="status != null and status != ''">
                and status = #{status}
            </if>
        </where>
    </select>

    <select id="selectDangerCollectByCompany" resultType="java.util.Map">
        select
        t2.user_id userId, t4.name, count(0) c, t2.flag, t2.status, IF(find_in_set(t1.id, t3.item3), 1, 0) AS d
        from
        t_check_item_tbl t1
        left join t_check_tbl t2 on t1.check_id = t2.id
        left join t_check_part_tbl tcp on t1.part_id = tcp.id
        left join t_rectification_tbl t3 on t1.check_id = t3.check_id
        left join t_company_tbl t5 on t5.user_id = t2.user_id
        left join company_view t4 on t2.user_id = t4.user_id
        <where>
            t2.del = 0 and t2.status = 2 and t1.status > 1 and t4.is_del = '0'
            <if test="userId != null">and t4.user_id = ${userId}</if>
            <if test="villageId != null">and t4.village_id = #{villageId}</if>
            <if test="townId != null">and t4.town_id = #{townId}</if>
            <if test="districtId != null">and t4.district_id = #{districtId}</if>
            <if test="tradeId != null">
                and t2.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
            <if test="industryType == 1">and t5.industry_id = 76</if>
            <if test="industryType == 2">and (t5.industry_id is null or t5.industry_id != 76)</if>
            <if test="companyName != null and companyName != ''">
                and t4.name LIKE CONCAT('%', #{companyName},'%')
            </if>
            <if test="startTime != null and startTime != ''">
                and DATE_FORMAT(t2.real_time, '%Y-%m-%d') >= #{startTime}
            </if>
            <if test="endTime != null and endTime != ''">
                <![CDATA[and DATE_FORMAT(t2.real_time, '%Y-%m-%d') <= #{endTime}]]>
            </if>
        </where>
        GROUP BY t2.user_id, t2.flag, t1.status, d
    </select>

    <select id="selectDangerCollectGroup" resultType="java.util.Map">
        select
        count(0) c, industry_id
        from
        t_check_item_view2
        <where>
            <if test="userId != null">
                and user_id = ${userId}
            </if>
            <if test="villageId != null">and village_id = #{villageId}</if>
            <if test="townId != null">and town_id = #{townId}</if>
            <if test="districtId != null">and district_id = #{districtId}</if>
            <if test="tradeId != null">
                and user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
            <if test="industryType == 1">and industry_id = 76</if>
            <if test="industryType == 2">and (industry_id is null or industry_id != 76)</if>
        </where>
        GROUP BY industry_id
    </select>

    <select id="selectNeedDangerIndexList" resultType="java.util.Map">
        select
        t4.name companyName, t2.real_time realTime,
        t1.id, t1.content, t1.reference, t1.status, t1.memo, t1.files,
        t1.levels,
        tcp.name partName, t1.check_id checkId,
        t2.depart, tcp.part_img partImg, t2.check_company checkCompany,
        t2.flag, t2.cheker,t2.industry_type industryType,
        IF(find_in_set(t1.id, t3.item3), 1, 0) AS d,
        (select count(0) from t_recheck_tbl where check_id = T1.check_id) c3,
        (select count(0) from t_rectification_tbl where check_id = T1.check_id) t
        from
        t_check_item_tbl t1
        left join t_check_tbl t2 on t1.check_id = t2.id
        left join t_check_part_tbl tcp on t1.part_id = tcp.id
        left join t_rectification_tbl t3 on t1.check_id = t3.check_id
        left join company_view t4 on t2.user_id = t4.user_id
        <where>
            t2.del = 0 and t2.status = 2 and t1.status > 1 and t4.is_del = '0'
            <if test="flag != null">
                and t2.flag = #{flag}
            </if>
            <if test="userId != null">
                and t4.user_id = ${userId}
            </if>
            <if test="villageId != null">
                and t4.village_id = ${villageId}
            </if>
            <if test="townId != null">
                and t4.town_id = ${townId}
            </if>
            <if test="districtId != null">
                and t4.district_id = ${districtId}
            </if>
            <if test="tradeId != null">
                and t4.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid = #{tradeId} )
            </if>
            <if test="memo != null and memo != ''">
                and t1.memo LIKE CONCAT('%', #{memo},'%')
            </if>
            <if test="companyName != null and companyName != ''">
                and t4.name LIKE CONCAT('%', #{companyName},'%')
            </if>
            <if test="partName != null and partName != ''">
                and t1.part_name LIKE CONCAT('%', #{partName},'%')
            </if>
            <if test="villageName != null and villageName != ''">
                and t4.village_name LIKE CONCAT('%', #{villageName},'%')
            </if>
            <if test="status != null and status != ''">
                and t1.status = #{status}
            </if>
            <if test="startTime != null and startTime != ''">
                and DATE_FORMAT(t2.real_time, '%Y-%m-%d') >= #{startTime}
            </if>
            <if test="endTime != null and endTime != ''">
                <![CDATA[and DATE_FORMAT(t2.real_time, '%Y-%m-%d') <= #{endTime}]]>
            </if>
        </where>
        <if test="d != null">
            having d = #{d}
        </if>
        order by t1.id desc, t2.real_time desc
    </select>

    <!--TODO 根据checkId     查询part和item
                检查记录主表      部位   详情
    -->
    <select id="selectAllByCheckId" resultType="java.util.Map" parameterType="Integer">
        select item.*, part.name
        from t_check_item_tbl item join t_check_part_tbl part
        on item.part_id = part.id
        where item.check_id =#{checkId}  order by item.id;
    </select>
    <!--根据id查询部门数据  -->
    <select id="selectAllById" resultMap="BaseResultMap">
        select * from t_check_item_tbl where id=#{id};
    </select>

    <select id="selectNumBytCheckId" resultType="Integer">
    select COUNT(*) from t_check_item_tbl where check_id = #{id} and status =2;
    </select>


    <select id="selectRecheckList" parameterType="java.lang.Integer" resultType="java.util.Map">
        select a.id as checkId,a.depart,b.status,b.memo,d.create_time as time,d.checker
        from t_check_tbl a JOIN t_check_item_tbl b ON a.id = b.check_id
        JOIN t_recheck_item_tbl c ON b.id = c.check_item_id
        JOIN t_recheck_tbl d ON c.recheck_id = d.id
        where d.user_id = #{userId}
        ORDER BY a.id

    </select>

    <!--只要整改复查合格的
    -->
    <select id="selectRecheckListByRecheckStatus" resultType="java.util.Map">
          select a.id as checkId,a.depart,b.status,b.memo,d.create_time as time,d.checker
        from t_check_tbl a JOIN t_check_item_tbl b ON a.id = b.check_id
        JOIN t_recheck_tbl d ON d.check_id=a.id
        where a.user_id = #{uid}
        and a.status=2
        and b.status in (1,3)
        ORDER BY a.id
    </select>

    <!--根据checkId获取所有的数据
    -->
    <select id="selectItemByCheckId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        select
        <include refid="Base_Column_List"/>
        from t_check_item_tbl
        where check_id =#{checkId} ;
    </select>


    <select id="selectAll" resultType="java.util.Map">
        select a.id as checkId,a.depart,b.status,b.memo,d.create_time as time,d.checker
        from t_check_tbl a JOIN t_check_item_tbl b ON a.id = b.check_id
        JOIN t_recheck_tbl d ON d.check_id=a.id
        where a.user_id in (${userIds})
        and a.status=2
        and b.status in (1,3)
        ORDER BY a.id
    </select>

    <!--隐患治理记录查询 企业自查
    -->
    <select id="selectListBystatus" resultType="java.util.Map" parameterType="INTEGER">
        select T2.type,
               T2.depart,
               T1.levels,
               T1.recheck_time,
               T2.real_time as realTime ,
               T1.content,
               T1.files,
               T1.recheck_file,
               T1.file_address,
               T1.status,
               T4.level,
               T4.fjgkfzr,
               T4.level2,
               T1.money,
               T1.level_id as levelId,
               T2.industry_type as industryType,
               T1.id as checkItemId,
               T2.id as checkId,
               T4.id as companyManualId,
               T3.id as checkPartId
        from smaq.t_check_item_tbl T1
             left join smaq.t_check_tbl T2 on T1.check_id = T2.id
             left join smaq.t_check_part_tbl T3 on T1.part_id = T3.id
             left join smaq.a_company_manual_tbl T4 on T1.level_id = T4.id
        where T2.user_id = #{userId}
          and T2.status = 2
          and T1.status = 1
          and T2.del= 0
          and T2.flag=#{flag}
          and T1.recheck_file is not null
          order by T2.real_time desc;
    </select>
    <!--
    现场
    -->
    <select id="selectXZListBystatus" resultType="java.util.Map">
        select T2.type,
               T2.depart,
               T1.levels,
               T1.recheck_time,
               T2.real_time as realTime ,
               T1.content,
               T1.files,
               T1.recheck_file,
               T1.file_address,
               T1.status,
               T4.level,
               T4.name level2,
               T1.money,
               T1.level_id as levelId,
               T2.industry_type as industryType,
               T1.id as checkItemId,
               T2.id as checkId,
               T4.id as companyManualId,
               T3.id as checkPartId
        from smaq.t_check_item_tbl T1
             left join smaq.t_check_tbl T2 on T1.check_id = T2.id
             left join smaq.t_check_part_tbl T3 on T1.part_id = T3.id
             left join a_danger_manual_tbl T4 on T1.level_id = T4.id
        where T2.user_id = #{userId}
          and T2.status = 2
          and T1.status = 1
          and T2.del= 0
          and T2.flag=#{flag}
          and T1.recheck_file is not null
          order by T2.real_time desc;
    </select>
    <!--
          基础
    -->
    <select id="selectBMCCListBystatus" resultType="java.util.Map">
        select T2.type,
               T2.depart,
               T1.levels,
               T1.recheck_time,
               T2.real_time as realTime ,
               T1.content,
               T1.files,
               T1.recheck_file,
               T1.file_address,
               T1.status,
               T4.name level2,
               T1.money,
               T1.level_id as levelId,
               T2.industry_type as industryType,
               T1.id as checkItemId,
               T2.id as checkId,
               T4.id as companyManualId,
               T3.id as checkPartId
        from smaq.t_check_item_tbl T1
             left join smaq.t_check_tbl T2 on T1.check_id = T2.id
             left join smaq.t_check_part_tbl T3 on T1.part_id = T3.id
             left join t_level_tbl T4 on T1.level_id = T4.id
        where T2.user_id = #{userId}
          and T2.status = 2
          and T1.status = 1
          and T2.del= 0
          and T2.flag=#{flag}
          and T1.recheck_file is not null
          order by T2.real_time desc;
    </select>

    <!-- 检查绩效分析 -->
    <select id="findHiddenSourceTypeByMap" resultType="Integer">
        select
        count(t1.id) as count
        from smaq.t_check_item_tbl t1
        left join smaq.t_check_tbl t2 on t1.check_id = t2.id
        where t2.status = 2
        and t2.del = 0
        and t2.flag = #{flag}
        and t2.depart = #{depart}
        and t2.industry_type = #{industry_type}
        and t2.user_id in (${userIds})
    </select>


    <!-- 检查绩效分析, 饼状图 -->
    <select id="selectHiddenSources" resultType="Integer">
        select
        count(t1.id) as count
        from smaq.t_check_item_tbl t1
        left join smaq.t_check_tbl t2 on t1.check_id = t2.id
        where t2.status = 2
        and t2.del = 0
        and t2.flag = #{flag}
        and t2.user_id in (${userIds})
    </select>



    <select id="lookHiddenSource" resultType="Integer">
        select
        count(t1.id) as count
        from smaq.t_check_item_tbl t1
        left join smaq.t_check_tbl t2 on t1.check_id = t2.id
        where t2.status = 2
        and t2.del = 0
        and t2.flag = #{flag}
        and t2.check_company = #{check_company}
        and t2.industry_type = #{industry_type}
        and t2.user_id in (${userIds})
    </select>


    <!-- 隐患数据分析  1. 较大; 2.重大; 3.一般和较小 -->
    <select id="findHiddenLevelTypeByMap"  resultType="Integer">
        SELECT
         count(t1.id) as count
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl c1 ON c1.id = t1.level_id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t2.depart = #{depart}
        AND t2.user_id = #{user_id}
        AND c1.flag = #{flag}
    </select>


    <!-- 隐患数据分析 饼状图  1. 较大; 2.重大; 3.一般和较小 -->
    <select id="findTypeByMap"  resultType="Integer">
        SELECT
         count(t1.id) as count
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl c1 ON c1.id = t1.level_id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t2.user_id in (${user_ids})
        AND c1.flag = #{flag}
    </select>


    <!-- 隐患治理数据分析 -->
    <select id="findRecheckFileByMap" resultType="Integer">
        SELECT
            count(t1.id)
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t1. status = #{status}
        AND t2.user_id = #{user_id}
        AND t3.flag = #{flag}
        AND t2.depart = #{depart}
        AND t1.recheck_file != ''
    </select>

    <!-- 政府端 隐患治理数据分析 企业 -->
    <select id="manageHiddenCompany" resultType="Integer">
        SELECT
            count(t1.id)
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t1. status = #{status}
        AND t2.user_id = #{user_id}
        AND t3.flag = #{flag}
        AND t1.recheck_file != ''
    </select>


    <!-- 政府端 隐患治理数据分析 风险 -->
    <select id="manageHiddenDanger" resultType="Integer">
        SELECT
            count(t1.id)
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t1. status = #{status}
        AND t3.control = #{control}
        AND t3.flag = #{flag}
        AND t1.recheck_file != ''
    </select>



    <!-- 政府端 隐患治理数据分析 风险 其他 -->
    <select id="manageHiddenDanger11" resultType="Integer">
        SELECT
            count(t1.id)
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t1. status = #{status}
        AND t3.control is null
        AND t3.flag = #{flag}
        AND t1.recheck_file != ''
    </select>


    <!-- 政府端 隐患治理数据分析 行业 -->
    <select id="manageHiddenIndustry" resultType="Integer">
        SELECT
            count(t1.id)
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t1. status = #{status}
        AND t3.industry like CONCAT('%', #{industry},'%')
        AND t3.flag = #{flag}
        AND t1.recheck_file != ''
    </select>

    <!-- 政府端 隐患治理数据分析 行业 其他 -->
    <select id="manageHiddenIndustry11" resultType="Integer">
        SELECT
            count(t1.id)
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t1. status = #{status}
        AND t3.industry is null
        AND t3.flag = #{flag}
        AND t1.recheck_file != ''
    </select>




    <!-- 隐患治理数据分析 饼状图 -->
    <select id="findFileByMap" resultType="Integer">
        SELECT
            count(t1.id)
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t1. status = 2
        AND t2.user_id = #{user_id}
        AND t3.flag = #{flag}
        AND t1.recheck_file != ''
    </select>




    <select id="findMapzhuChartData2" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        AND t2.depart = #{depart}
        AND t2.flag = #{flag}
        AND t2.user_id = #{user_id}
    </select>


    <select id="zhuChartData66" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t3.control = #{control}
        AND t2.depart = #{depart}
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
    </select>

    <!-- 政府端 隐患排查对象分析数据 -->
    <select id="zfHiddenTrouble" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t3.control = #{control}
        AND t2.flag = #{flag}
        AND t2.user_id = {user_id}
    </select>

    <!-- 政府端 隐患排查对象分析数据 -->
    <select id="zfHiddenTrouble11" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t3.control is null
        AND t2.flag = #{flag}
        AND t2.user_id = {user_id}
    </select>


    <select id="zhuChartData661" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t3.control is null
        AND t2.depart = #{depart}
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
    </select>


    <select id="zhuChartData67" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t3.control = #{control}
        AND t2.check_company = #{check_company}
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
    </select>

    <select id="zhuChartData671" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t3.control is null
        AND t2.check_company = #{check_company}
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
    </select>


    <!-- 排查对象分析 柱状图 flag == 1-->
    <select id="zhuChartData78" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t3.control = #{control}
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
        <if test='departs != "" '>
        AND t2.depart in (${departs})
        </if>
    </select>


    <select id="zhuChartData781" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t3.control is null
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
        <if test='departs != "" '>
            AND t2.depart in (${departs})
        </if>
    </select>



    <select id="zhuChartData77" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t3.control = #{control}
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
    </select>

    <select id="zhuChartData771" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t3.control is null
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
    </select>



    <!-- 隐患数据分析 柱状图 flag = 1-->
    <select id="zhuChartData88" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
        <if test='departs != "" '>
            AND t2.depart in (${departs})
        </if>
    </select>

    <select id="zhuChartData881" resultType="Integer">
        SELECT
        count(t1.id) as counts
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control is null
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
        <if test='departs != "" '>
            AND t2.depart in (${departs})
        </if>
    </select>


    <!-- 政府端 隐患数据分析 柱状图 flag = 1-->
    <select id="zhengFuChartData88" resultType="Integer">
        SELECT
        count(t1.id) as counts
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        AND t2.flag = #{flag}
        AND t2.user_id = {user_id}
    </select>

    <!-- 政府端 隐患数据分析 风险 flag = 1-->
    <select id="zhengFuChartData881" resultType="Integer">
         SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control is null
        AND t2.flag = #{flag}
        AND t2.user_id = #{user_id}
    </select>


    <!-- 政府端 隐患数据分析 行业 flag = 1-->
    <select id="zhengFuChartDataDanger" resultType="Integer">
         SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        LEFT JOIN company_view c1 ON t2.user_id = c1.user_id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t2.flag = #{flag}
        AND c1.industry  like  CONCAT('%', #{industry},'%')
        AND t2.user_id = #{user_id}
    </select>


    <!-- 政府端 隐患数据分析 行业 flag = 1-->
    <select id="zhengFuChartDataDanger11" resultType="Integer">
         SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        LEFT JOIN company_view c1 ON t2.user_id = c1.user_id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND c1.industry  is null
        AND t2.flag = #{flag}
        AND t2.user_id = #{user_id}
    </select>




    <select id="zhuChartData89" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
    </select>

    <select id="zhuChartData891" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control is null
        AND t2.flag = #{flag}
        AND t2.user_id in (${user_ids})
    </select>



    <!-- 企业自查隐患数据分析 -->
    <select id="zhuChartData22" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        AND t2.depart = #{depart}
        AND t2.flag = #{flag}
        AND t2.user_id = #{user_id}
    </select>

    <select id="zhuChartData221" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control is null
        AND t2.depart = #{depart}
        AND t2.flag = #{flag}
        AND t2.user_id = #{user_id}
    </select>


    <!-- 其他自查隐患数据分析 -->
    <select id="zhuChartData23" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        AND t2.check_company = #{check_company}
        AND t2.flag = #{flag}
        AND t2.user_id = #{user_id}
    </select>

    <select id="zhuChartData231" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control is null
        AND t2.check_company = #{check_company}
        AND t2.flag = #{flag}
        AND t2.user_id = #{user_id}
    </select>


    <!-- 隐患治理数据分析 柱状图 -->
    <select id="zhuChartData125" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        AND t2.user_id = #{user_id}
        AND t2.depart in (${departs})
    </select>



    <select id="zhuChartData124" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        AND t2.user_id = #{user_id}
    </select>

    <select id="zhuChartData1241" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control is null
        AND t2.depart != #{depart}
        AND t2.user_id = #{user_id}
    </select>


    <!-- 隐患治理对象分析 -->
    <select id="zhuChartData123" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        AND t2.depart = #{depart}
        AND t2.user_id = #{user_id}
    </select>

    <select id="zhuChartData1231" resultType="Integer">
        SELECT
            count(t1.id) as counts
        FROM
            smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        WHERE
            t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control is null
        AND t2.depart = #{depart}
        AND t2.user_id = #{user_id}
    </select>

    <!--排查数据分析,合格/不合格/已复查
    -->
    <select id="selectFailedByMap" resultType="com.spring.web.ibatis.DynamicParameter" parameterType="java.util.Map">
        select DATE_FORMAT(t2.real_time, '%Y-%m') time,
        sum(case t1.status when 1 then 1 else 0 end ) a,
        sum(case t1.status when 2 then 1 else 0 end ) b,
        sum(case t1.status when 3 then 1 else 0 end ) c,
        t2.flag
        from smaq.t_check_item_tbl t1
        inner join smaq.t_check_tbl t2 on t1.check_id = t2.id
        <where>
            and
            <![CDATA[DATE_FORMAT(t2.real_time, '%Y-%m') >= #{startTime1} and DATE_FORMAT(t2.real_time, '%Y-%m') <= #{endTime1}]]>
            and t2.status = 2
            and t2.del = 0
            and t2.user_id = #{uid}
            <if test="flag!=null">
                and t2.flag=#{flag}
            </if>
            <if test="type!=null">
                and t2.type=#{type}
            </if>
        </where>
        group by time;
    </select>
    <!--治理数据分析<已复查合格/复查不合格的参数>(单位: 天)

    -->
    <select id="selectRecheckFileByMap" resultType="com.spring.web.ibatis.DynamicParameter"
            parameterType="java.util.Map">

        select DATE_FORMAT(t2.real_time, '%Y-%m') time,
        sum(case t1.status when 3 then 1 else 0 end ) a,
        sum(case t1.status when 2 then 1 else 0 end ) b
        from smaq.t_check_item_tbl t1
        left join smaq.t_check_tbl t2 on t1.check_id = t2.id
        left join smaq.a_company_manual_tbl t3 on t1.level_id=t3.id
        <where>
            and
            <![CDATA[DATE_FORMAT(t2.real_time, '%Y-%m') >= #{startTime1} and DATE_FORMAT(t2.real_time, '%Y-%m') <= #{endTime1}]]>
            and t2.status = 2
            and t2.del = 0
            and t2.user_id = #{uid}
            <if test="flag !=null">
                and t3.flag=#{flag}
            </if>

            <if test="depart !=null">
                and t2.depart = #{depart}
            </if>

            and t1.recheck_file != ''
        </where>
        group by time;
    </select>
    <!--   排查数据分析之隐患类型   -->
    <select id="selectHiddenDangerTypeByMap" resultType="com.spring.web.ibatis.DynamicParameter"
            parameterType="java.util.Map">
        select
        s1.time as useTime,
        sum(case when s1.industry_type=1 then 1 else 0 end ) a,
        sum(case when s1.industry_type=2 then 1 else 0 end ) b,
        sum(case when s1.industry_type=3 then 1 else 0 end ) c,
        count(s1.id) count
        from (select
        t1.id as id ,t2.industry_type,DATE_FORMAT(t2.real_time, '%Y-%m') time
        from smaq.t_check_item_tbl t1
        left join smaq.t_check_tbl t2 on t1.check_id = t2.id
        where t2.status = #{status}
        and t2.del = #{del}
        <if test="flag != null">
            and t2.flag = #{flag}
        </if>
        <if test="depart != null">
            and t2.depart =  #{depart}
        </if>
        and <![CDATA[DATE_FORMAT(t2.real_time, '%Y-%m') >= #{startTime1} and DATE_FORMAT(t2.real_time, '%Y-%m') <= #{endTime1}]]>
        and t2.user_id=#{uid}) s1
        group by s1.time;
    </select>
    <select id="selectHiddenSourceTypeByMap" resultType="com.spring.web.ibatis.DynamicParameter"
            parameterType="java.util.Map">
         select
        s1.time as useTime,
        sum(case when s1.flag=1 then 1 else 0 end ) a,
        sum(case when s1.flag=2 then 1 else 0 end ) b,
        sum(case when s1.flag=3 then 1 else 0 end ) c,
        count(s1.id) count
        from (select
        t1.id as id ,t2.flag,DATE_FORMAT(t2.real_time, '%Y-%m') time
        from smaq.t_check_item_tbl t1
        left join smaq.t_check_tbl t2 on t1.check_id = t2.id
        left join smaq.a_company_manual_tbl t3 on t1.level_id=t3.id
        where t2.status = #{status}
        and t2.del = #{del}

        <if test="control != null">
            and t3.control = #{control}
        </if>

        and <![CDATA[DATE_FORMAT(t2.real_time, '%Y-%m') >= #{startTime1} and DATE_FORMAT(t2.real_time, '%Y-%m') <= #{endTime1}]]>
        and t2.user_id=#{uid}) s1
        group by s1.time;
    </select>



    <select id="selectMapzhuChartData2" resultType="com.spring.web.ibatis.DynamicParameter"
            parameterType="java.util.Map">
        select
        s1.time as useTime,
        sum(case when s1.flag=1 then 1 else 0 end ) a,
        sum(case when s1.flag=2 then 1 else 0 end ) b,
        sum(case when s1.flag=3 then 1 else 0 end ) c,
        count(s1.id) count
        from (select
        t1.id as id ,t2.flag,DATE_FORMAT(t2.real_time, '%Y-%m') time
        from smaq.t_check_item_tbl t1
        left join smaq.t_check_tbl t2 on t1.check_id = t2.id
        left join smaq.a_company_manual_tbl t3 on t1.level_id=t3.id
        where t2.status = #{status}
        and t2.del = #{del}
        and t1.status = 2
        <if test="control != null">
            and t3.control = #{control}
        </if>
        and <![CDATA[DATE_FORMAT(t2.real_time, '%Y-%m') >= #{startTime1} and DATE_FORMAT(t2.real_time, '%Y-%m') <= #{endTime1}]]>
        and t2.user_id=#{uid}) s1
        group by s1.time;
    </select>





    <select id="selectHiddenLevelTypeByMap" resultType="com.spring.web.ibatis.DynamicParameter"
            parameterType="java.util.Map">
        select
        s1.time as useTime,
        sum(case when s1.flag=1 then 1 else 0 end ) a,
        sum(case when s1.flag=2 then 1 else 0 end ) b,
        sum(case when s1.flag=3 then 1 else 0 end ) c
        from (select
        t1.id as id ,c1.flag,DATE_FORMAT(t2.real_time, '%Y-%m') time
        from smaq.t_check_item_tbl t1
        left join smaq.t_check_tbl t2 on t1.check_id = t2.id
        left join smaq.a_company_manual_tbl c1 on c1.id=t1.level_id
        where t2.status = #{status}
        and t2.del = #{del}

        <if test="flag != null">
            and t2.flag = #{flag}
        </if>

        <if test="depart != null">
            and t2.depart =  #{depart}
        </if>

        and <![CDATA[DATE_FORMAT(t2.real_time, '%Y-%m') >= #{startTime1} and DATE_FORMAT(t2.real_time, '%Y-%m') <= #{endTime1}]]>
        and t2.user_id=#{uid}) s1
        group by s1.time;
    </select>
    <!--根据checkId查询levelId-->
    <select id="selectLevelIdByCheckId" parameterType="Integer"  resultType="Integer" >
    SELECT level_id FROM t_check_item_tbl WHERE check_id = #{id} AND level_id IS NOT NULL;
    </select>


    <select id="selectHiddenSourcesByGvo" parameterType="Integer" resultType="Integer">
        select
        count(t1.id) as count
        from smaq.t_check_item_tbl t1
        left join smaq.t_check_tbl t2 on t1.check_id = t2.id
        left join company_view t3 on t2.user_id = t3.user_id
        where t2.status = 2
        and t2.del = 0
        and t2.flag = #{flag}
        <if test="type!=9">
            <if test="type==6">
                and t3.district_id = #{userId}
            </if>
            <if test="type==3">
                and t3.town_id = #{userId}
            </if>
            <if test="type==4">
                and t3.village_id = #{userId}
            </if>
            <if test="type==10">
                and t3.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </if>
    </select>


    <select id="zhuChartData77ByGeo" parameterType="Integer" resultType="Integer">
        SELECT
        count(t1.id) as counts
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        LEFT join company_view t4 ON t2.user_id = t4.user_id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND t3.control = #{control}
        AND t2.flag = #{flag}
        <if test="type!=9">
            <if test="type==6">
                AND t4.district_id = #{userId}
            </if>
            <if test="type==3">
                AND t4.town_id = #{userId}
            </if>
            <if test="type==4">
                AND t4.village_id = #{userId}
            </if>
            <if test="type==10">
                AND t4.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </if>
    </select>

    <select id="zhuChartData88Geo" resultType="Integer">
        SELECT
        count(t1.id) as counts
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        LEFT JOIN smaq.company_view t4 on t2.user_id = t4.user_id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        AND t2.flag = #{flag}
        <if test="type!=9">
            <if test="type==6">
                AND t4.district_id = #{userId}
            </if>
            <if test="type==3">
                AND t4.town_id = #{userId}
            </if>
            <if test="type==4">
                AND t4.village_id = #{userId}
            </if>
            <if test="type==10">
                AND t4.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </if>
    </select>
    <select id="findFileByGeo" resultType="Integer">
        SELECT
        count(t1.id)
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        LEFT JOIN smaq.company_view  t4 ON t2.user_id = t4.user_id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t1. status = 2
        AND t3.flag = #{flag}
        AND t1.recheck_file != ''
        <if test="type!=9">
            <if test="type==6">
                AND t4.district_id = #{userId}
            </if>
            <if test="type==3">
                AND t4.town_id = #{userId}
            </if>
            <if test="type==4">
                AND t4.village_id = #{userId}
            </if>
            <if test="type==10">
                AND t4.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </if>
    </select>

    <select id="zhuChartData124Geo" resultType="Integer">
        SELECT
        count(t1.id) as counts
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        LEFT JOIN smaq.company_view t4 ON t2.user_id = t4.user_id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t3.control = #{control}
        <if test="type!=9">
            <if test="type==6">
                AND t4.district_id = #{userId}
            </if>
            <if test="type==3">
                AND t4.town_id = #{userId}
            </if>
            <if test="type==4">
                AND t4.village_id = #{userId}
            </if>
            <if test="type==10">
                AND t4.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </if>
    </select>

    <select id="selectCompanyId" parameterType="Integer" resultType="Integer">
        SELECT user_id FROM company_view
        <where>
            <if test="type==6">
                district_id = #{userId}
            </if>
            <if test="type==3">
                town_id = #{userId}
            </if>
            <if test="type==4">
                village_id = #{userId}
            </if>
            <if test="type==10">
                user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </where>
    </select>


    <select id="findALL" parameterType="Integer" resultType="java.util.Map">
        SELECT * FROM company_view
        <where>
            <if test="type==6">
                district_id = #{userId}
            </if>
            <if test="type==3">
                town_id = #{userId}
            </if>
            <if test="type==4">
                village_id = #{userId}
            </if>
            <if test="type==10">
                user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </where>
    </select>






    <select id="findTypeByGeo" resultType="Integer">
        SELECT
        count(t1.id) as count
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl c1 ON c1.id = t1.level_id
        left join smaq.company_view c2 on t2.user_id = c2.user_id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND c1.flag = #{flag}
        <if test="type!=9">
            <if test="type==6">
                and c2.district_id = #{userId}
            </if>
            <if test="type==3">
                and c2.town_id = #{userId}
            </if>
            <if test="type==4">
                and c2.village_id = #{userId}
            </if>
            <if test="type==10">
                and c2.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </if>
    </select>

    <select id="selectXZListBystatusGeo" resultType="java.util.Map" parameterType="INTEGER">
        select T2.type,
        T2.depart,
        T1.levels,
        T1.recheck_time,
        T2.real_time as realTime ,
        T1.content,
        T1.files,
        T1.recheck_file,
        T1.file_address,
        T1.status,
        T4.level,
        T4.name level2,
        T1.money,
        T1.level_id as levelId,
        T2.industry_type as industryType,
        T1.id as checkItemId,
        T2.id as checkId,
        T4.id as companyManualId,
        T3.id as checkPartId,
        T5.user_id as userId
        from smaq.t_check_item_tbl T1
        left join smaq.t_check_tbl T2 on T1.check_id = T2.id
        left join smaq.t_check_part_tbl T3 on T1.part_id = T3.id
        left join a_danger_manual_tbl T4 on T1.level_id = T4.id
        left join smaq.company_view T5 on (T5.user_id = T2.user_id and T1.check_id = T2.id)
        where
        T2.status = 2
        and T1.status > 1
        and T2.del= 0
        and T2.flag=#{flag}
        and T1.recheck_file is not null
        <if test="type!=9">
            <if test="type==6">
                and T5.district_id = #{userId}
            </if>
            <if test="type==3">
                and T5.town_id = #{userId}
            </if>
            <if test="type==4">
                and T5.village_id = #{userId}
            </if>
            <if test="type==10">
                and T5.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </if>
        order by T2.real_time desc;
    </select>
    <select id="selectBMCCListBystatusGeo" resultType="java.util.Map" parameterType="INTEGER">
        select T2.type,
        T2.depart,
        T1.levels,
        T1.recheck_time,
        T2.real_time as realTime ,
        T1.content,
        T1.files,
        T1.file_address,
        T1.status,
        T4.name level2,
        T1.money,
        T1.level_id as levelId,
        T2.industry_type as industryType,
        T1.id as checkItemId,
        T2.id as checkId,
        T4.id as companyManualId,
        T3.id as checkPartId,
        T5.user_id as userId
        from smaq.t_check_item_tbl T1
        left join smaq.t_check_tbl T2 on T1.check_id = T2.id
        left join smaq.t_check_part_tbl T3 on T1.part_id = T3.id
        left join t_level_tbl T4 on T1.level_id = T4.id
        left join smaq.company_view T5 on T2.user_id=T5.user_id
        where
        T2.status = 2
        and T1.status > 1
        and T2.del= 0
        and T2.flag= #{flag}
        and T1.recheck_file is not null
        <if test="type!=9">
            <if test="type==6">
                and T5.district_id = #{userId}
            </if>
            <if test="type==3">
                and T5.town_id = #{userId}
            </if>
            <if test="type==4">
                and T5.village_id = #{userId}
            </if>
            <if test="type==10">
                and T5.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </if>
        order by T2.real_time desc;
    </select>
    <select id="selectNumByhangye" resultType="java.util.Map" parameterType="INTEGER">
        SELECT
        count(if(control='生产工艺', 'Y', null)) as gongyi,
        count(if(control='设备设施', 'Y', null)) as shebei,
        count(if(control='特种设备', 'Y', null)) as teizhong,
        count(if(control='消防安全', 'Y', null)) as xiaofang,
        count(if(control='用电安全', 'Y', null)) as yongdian,
        count(if(control='行为环境', 'Y', null)) as xingwei,
        count(if(control='公辅设备', 'Y', null)) as gongfu,
        count(if(control='危化管理', 'Y', null)) as weihua,
        count(if(control='基础管理', 'Y', null)) as jichu,
        count(if(control='防雷静电', 'Y', null)) as fanglei,
        count(if(control='安全设施', 'Y', null)) as anquan,
        count(if(control='职业卫生', 'Y', null)) as weisheng,
        count(if(control='生产现场', 'Y', null)) as xianchang,
        count(if(control= null, 'Y', null)) as qita
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        left join company_view t4 on t2.user_id = t4.user_id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND t2.flag = #{flag}
        <if test="type!=9">
            <if test="type==6">
                and t4.district_id = #{userId}
            </if>
            <if test="type==3">
                and t4.town_id = #{userId}
            </if>
            <if test="type==4">
                and t4.village_id = #{userId}
            </if>
            <if test="type==10">
                and t4.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </if>
    </select>
    <select id="selectHiddenSourcesByGvo2" resultType="java.util.Map" parameterType="INTEGER">
        select
        count(if(t2.flag=1, '1', null)) as number1,
        count(if(t2.flag=2, '1', null)) as number2,
        count(if(t2.flag=3, '1', null)) as number3
        from smaq.t_check_item_tbl t1
        left join smaq.t_check_tbl t2 on t1.check_id = t2.id
        left join company_view t3 on t2.user_id = t3.user_id
        where t2.status = 2
        and t2.del = 0

        <if test="type==6">
            and t3.district_id = #{userId}
        </if>
        <if test="type==3">
            and t3.town_id = #{userId}
        </if>
        <if test="type==4">
            and t3.village_id = #{userId}
        </if>
        <if test="type==10">
            and t3.user_id  ( select uid from trade_company_tbl where tid =
            #{userId})
        </if>

    </select>
    <select id="zhuChartData882" resultType="java.util.Map" parameterType="INTEGER">
        SELECT
        count(if(t3.control='生产工艺', 'Y', null)) as gongyi,
        count(if(t3.control='设备设施', 'Y', null)) as shebei,
        count(if(t3.control='特种设备', 'Y', null)) as teizhong,
        count(if(t3.control='消防安全', 'Y', null)) as xiaofang,
        count(if(t3.control='用电安全', 'Y', null)) as yongdian,
        count(if(t3.control='行为环境', 'Y', null)) as xingwei,
        count(if(t3.control='公辅设备', 'Y', null)) as gongfu,
        count(if(t3.control='危化管理', 'Y', null)) as weihua,
        count(if(t3.control='基础管理', 'Y', null)) as jichu,
        count(if(t3.control='防雷静电', 'Y', null)) as fanglei,
        count(if(t3.control='安全设施', 'Y', null)) as anquan,
        count(if(t3.control='职业卫生', 'Y', null)) as weisheng,
        count(if(t3.control='生产现场', 'Y', null)) as xianchang,
        count(if(t3.control= null, 'Y', null)) as qita
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        LEFT JOIN smaq.company_view t4 on t2.user_id = t4.user_id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t2.flag = #{flag}

        <if test="type==6">
            and t4.district_id = #{userId}
        </if>
        <if test="type==3">
            and t4.town_id = #{userId}
        </if>
        <if test="type==4">
            and t4.village_id = #{userId}
        </if>
        <if test="type==10">
            and t4.user_id in ( select uid from trade_company_tbl where tid =
            #{userId}
            )
        </if>

    </select>
    <select id="findTypeByGeo2" resultType="java.util.Map" parameterType="INTEGER">
        SELECT
        COUNT(if(c1.flag=3,'1', null)) AS number1,
        COUNT(if(c1.flag=2,'1', null)) AS number2,
        COUNT(if(c1.flag=1,'1', null)) AS number3
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl c1 ON c1.id = t1.level_id
        LEFT JOIN smaq.company_view c2 ON t2.user_id = c2.user_id
        WHERE
        t2. status = 2
        AND t2.del = 0
        <if test="type!=9">
            <if test="type==6">
                AND c2.district_id = #{userId}
            </if>
            <if test="type==3">
                AND c2.town_id = #{userId}
            </if>
            <if test="type==4">
                AND c2.village_id = #{userId}
            </if>
            <if test="type==10">
                AND c2.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
                #{userId}
                )
            </if>
        </if>
    </select>
    <select id="findFileByGeo2" resultType="java.util.Map" parameterType="INTEGER">
        SELECT
        COUNT(if(t3.flag=3,'1',null)) AS number4,
        COUNT(if(t3.flag=2,'1',null)) AS number5,
        COUNT(if(t3.flag=1,'1',null)) AS number6
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        left join smaq.company_view  t4 on t2.user_id = t4.user_id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        AND t1. status = 2
        AND t1.recheck_file != ''
        <if test="type==6">
            AND t4.district_id = #{userId}
        </if>
        <if test="type==3">
            AND t4.town_id = #{userId}
        </if>
        <if test="type==4">
            AND t4.village_id = #{userId}
        </if>
        <if test="type==10">
            AND t4.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
            #{userId}
            )
        </if>
    </select>
    <select id="zhuChartData124Geo2" resultType="java.util.Map" parameterType="INTEGER">
        select
        COUNT(if(t3.control='生产工艺', 'Y', null)) AS gongyi,
        COUNT(if(t3.control='设备设施', 'Y', null)) AS shebei,
        COUNT(if(t3.control='特种设备', 'Y', null)) AS teizhong,
        COUNT(if(t3.control='消防安全', 'Y', null)) AS xiaofang,
        COUNT(if(t3.control='用电安全', 'Y', null)) AS yongdian,
        COUNT(if(t3.control='行为环境', 'Y', null)) AS xingwei,
        COUNT(if(t3.control='公辅设备', 'Y', null)) AS gongfu,
        COUNT(if(t3.control='危化管理', 'Y', null)) AS weihua,
        COUNT(if(t3.control='基础管理', 'Y', null)) AS jichu,
        COUNT(if(t3.control='防雷静电', 'Y', null)) AS fanglei,
        COUNT(if(t3.control='安全设施', 'Y', null)) AS anquan,
        COUNT(if(t3.control='职业卫生', 'Y', null)) AS weisheng,
        COUNT(if(t3.control='生产现场', 'Y', null)) AS xianchang,
        COUNT(if(t3.control= null, 'Y', null)) AS qita
        FROM
        smaq.t_check_item_tbl t1
        LEFT JOIN smaq.t_check_tbl t2 ON t1.check_id = t2.id
        LEFT JOIN smaq.a_company_manual_tbl t3 ON t1.level_id = t3.id
        left join smaq.company_view t4 on t2.user_id = t4.user_id
        WHERE
        t2. status = 2
        AND t2.del = 0
        AND t1.status = 2
        <if test="type==6">
            AND t4.district_id = #{userId}
        </if>
        <if test="type==3">
            AND t4.town_id = #{userId}
        </if>
        <if test="type==4">
            AND t4.village_id = #{userId}
        </if>
        <if test="type==10">
            AND t4.user_id IN ( SELECT uid FROM trade_company_tbl WHERE tid =
            #{userId}
            )
        </if>
    </select>


    <!--新增部分-->
    <select id="selectListBystatusGeo" resultType="java.util.Map" parameterType="INTEGER">
        select T2.type,
        T2.depart,
        T1.levels,
        T1.recheck_time,
        T2.real_time as realTime ,
        T1.content,
        T1.files,
        T1.recheck_file,
        T1.file_address,
        T1.status,
        T4.level,
        T4.fjgkfzr,
        T4.level2,
        T1.money,
        T1.level_id as levelId,
        T2.industry_type as industryType,
        T1.id as checkItemId,
        T2.id as checkId,
        T4.id as companyManualId,
        T3.id as checkPartId,
        T5.user_id as userId
        from smaq.t_check_item_tbl T1
        left join smaq.t_check_tbl T2 on T1.check_id = T2.id
        left join smaq.t_check_part_tbl T3 on T1.part_id = T3.id
        left join smaq.a_company_manual_tbl T4 on T1.level_id = T4.id
        left join smaq.company_view T5 on T2.user_id = T5.user_id
        where
        T2.status = 2
        and T1.status > 1
        and T2.del= 0
        and T2.flag=#{flag}
        and T1.recheck_file is not null

        <if test="type==6">
            and T5.district_id = #{userId}
        </if>
        <if test="type==3">
            and T5.town_id = #{userId}
        </if>
        <if test="type==4">
            and T5.village_id = #{userId}
        </if>
        <if test="type==10">
            and T5.user_id in ( select uid from trade_company_tbl where tid =
            #{userId}
            )
        </if>

        order by T2.real_time desc;
    </select>

    <select id="selectBasicMessage" resultType="java.util.Map" parameterType="INTEGER">
        select t2.name as name, t2.industry as industry, t2.dlevel as dlevel, t1.user_id as userId
        from company_view t1
        left join company_tbl t2 on t1.user_id = t2.user_id
        where
        t1.is_del=0
        <if test="type==6">
            and t1.district_id = #{userId}
        </if>
        <if test="type==3">
            and t1.town_id = #{userId}
        </if>
        <if test="type==4">
            and t1.village_id = #{userId}
        </if>
        <if test="type==10">
            and t1.user_id in ( select uid from trade_company_tbl where tid =
            #{userId}
            )
        </if>
    </select>
    <select id="getTotalPage"  parameterType="INTEGER" resultType="Integer">
        select count(*)
        from company_view t1
        left join company_tbl t2 on t1.user_id = t2.user_id
        where
        t1.is_del=0
        <if test="type==6">
            and t1.district_id = #{userId}
        </if>
        <if test="type==3">
            and t1.town_id = #{userId}
        </if>
        <if test="type==4">
            and t1.village_id = #{userId}
        </if>
        <if test="type==10">
            and t1.user_id in ( select uid from trade_company_tbl where tid =
            #{userId}
            )
        </if>
    </select>
    <select id="getData" parameterType="INTEGER" resultType="java.util.Map">
        select t2.name as name, t2.industry as industry, t2.dlevel as dlevel, t1.user_id as userId
        from company_view t1
        left join company_tbl t2 on t1.user_id = t2.user_id
        where
        t1.is_del=0
        <if test="type==6">
            and t1.district_id = #{userId}
        </if>
        <if test="type==3">
            and t1.town_id = #{userId}
        </if>
        <if test="type==4">
            and t1.village_id = #{userId}
        </if>
        <if test="type==10">
            and t1.user_id in ( select uid from trade_company_tbl where tid =
            #{userId}
            )
        </if>
        limit #{start}, 20
    </select>
</mapper>